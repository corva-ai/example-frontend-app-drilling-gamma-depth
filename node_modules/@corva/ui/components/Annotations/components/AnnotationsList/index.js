import t from"@babel/runtime/helpers/defineProperty";import e from"@babel/runtime/helpers/slicedToArray";import n from"@babel/runtime/regenerator";import o from"@babel/runtime/helpers/asyncToGenerator";import{isNativeDetected as r}from"../../../../utils/mobileDetect.js";import{showSuccessNotification as a}from"../../../../utils/notificationToasts.js";import"../../../../utils/index.js";import{jsx as i,jsxs as s,Fragment as c}from"react/jsx-runtime";import{RootRef as p,Paper as d,Typography as m,Tooltip as l,IconButton as u}from"@material-ui/core";import{memo as f,useRef as h,useState as y,useEffect as b}from"react";import{getAnnotations as g}from"../../../../clients/jsonApi/index.js";import A from"../../../../effects/useOutsideClick.js";import{number as v,string as I,shape as C,func as T,bool as N}from"prop-types";import x from"classnames";import{withStyles as j}from"@material-ui/core/styles";import L from"@material-ui/icons/ChevronLeft";import k from"../../../InfiniteList/index.js";import{SET_ANNOTATIONS as R,APPEND_ANNOTATIONS as _}from"../../constants.js";import{useAnnotationsState as q,useAnnotationsDispatch as w}from"../../AnnotationsContext.js";import S from"./components/AddAnnotationForm/index.js";import H from"./components/Annotation/index.js";import U from"./style.css.js";var F="AppAnnotationsPo",O=function(r){var f,v=r.appId,I=r.appTitle,C=r.assetId,T=r.assetCompanyId,N=r.appSettings,j=r.currentUser,O=r.onClose,P=r.isNative,W=r.classes,B=r.dashboardType,D=q().annotations,E=w(),G=h(),M=h();A(G,O);var z=y(!1),J=e(z,2),K=J[0],Q=J[1],V=y(!0),X=e(V,2),Y=X[0],Z=X[1],$=y(!0),tt=e($,2),et=tt[0],nt=tt[1],ot=y(1),rt=e(ot,2),at=rt[0],it=rt[1];function st(){return(st=o(n.mark((function t(){var e,o,r;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(v&&C){t.next=2;break}return t.abrupt("return");case 2:return Z(!0),t.prev=3,o={page:at,per_page:4,sort:"created_at",order:"desc"},B&&(o.dashboard_type=B),t.next=8,g(v,C,o);case 8:e=t.sent,E({type:1===at?R:_,annotations:e}),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),console.error(t.t0);case 15:r=e&&e.data.length<4,it(at+1),nt(!r),Z(!1);case 19:case"end":return t.stop()}}),t,null,[[3,12]])})))).apply(this,arguments)}return b((function(){Q(!0)}),[]),i(p,{rootRef:G,children:s(d,{className:x(U.cAnnotationsList,(f={},t(f,U.cAnnotationsListOpen,K),t(f,U.cAnnotationsListOpenNative,P),f)),children:[i(k,{infiniteClassName:U.cAnnotationsListContentContainer,headerComponent:s(c,{children:[i(m,{"data-testid":"".concat(F,"_appTitle"),variant:"body1",className:W.title,children:I}),i("div",{className:U.cAnnotationsListContentTop,children:s(m,{"data-testid":"".concat(F,"_annotationsTitle"),variant:"caption",className:W.secondaryTitle,children:["Annotations (",D.data?D.data.length:0,")"]})}),i(S,{appId:v,assetId:C,assetCompanyId:T,appSettings:N,currentUser:j,dashboardType:B})]}),useWindow:P,items:D.data||[],showNoItemsFound:!(D.data&&0!==D.data.length||Y),noItemsFoundLabel:i(m,{variant:"body2","data-testid":"".concat(F,"_noAnnotations"),className:W.noAnnotations,children:"No Annotations yet"}),threshold:50,infiniteContainerHeight:G.current&&M.current?G.current.clientHeight-M.current.clientHeight:null,moreItemsMayExist:et,pathToCreatedAt:["attributes","created_at"],renderItem:function(t){return i(H,{isNative:P,annotation:t,assetCompanyId:T,included:D.included,currentUser:j,showSuccessNotification:a},t.id)},loadItems:function(){return st.apply(this,arguments)}}),i("div",{className:U.cAnnotationsListActions,ref:M,children:i(l,{title:"Hide",placement:"bottom",children:i(u,{"data-testid":"".concat(F,"_hideButton"),onClick:O,className:W.backIcon,children:i(L,{})})})})]})})};O.propTypes={appId:v.isRequired,appTitle:I.isRequired,assetId:v.isRequired,assetCompanyId:v.isRequired,appSettings:C(),classes:C().isRequired,onClose:T.isRequired,currentUser:C({}).isRequired,isNative:N,dashboardType:I},O.defaultProps={appSettings:{},isNative:r,dashboardType:null};var P=j((function(t){return{title:{fontWeight:200,marginBottom:20},secondaryTitle:{fontWeight:200,textTransform:"uppercase",color:t.palette.grey[600]},annotateIcon:{padding:0,"&:hover":{backgroundColor:"transparent",boxShadow:"none"}},noAnnotations:{marginTop:16},backIcon:{cursor:"pointer",color:t.palette.grey[600],padding:5}}}))(f(O));export default P;
