import e from"@babel/runtime/helpers/defineProperty";import"@babel/runtime/helpers/toConsumableArray";import"moment";import"lodash";import r from"@babel/runtime/helpers/slicedToArray";import"lodash/get";import"lodash/set";import t from"@babel/runtime/regenerator";import n from"@babel/runtime/helpers/asyncToGenerator";import{useState as a,useEffect as s,useRef as o}from"react";import"lodash/unset";import"../../../clients/api/apiCore.js";import"../../../clients/constants.js";import{mapAssetGetRequest as p}from"../../../clients/jsonApi/index.js";import"../../../clients/subscriptions.js";import"uuid";import{PER_PAGE as i}from"../constants.js";function c(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(r){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){e(r,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}))}return r}var f=function(e){return{sort:"name",order:"asc",fields:["".concat(e,".name"),"".concat(e,".asset_id")]}},l=function(e){return u(u({},e.attributes),{},{id:+e.id})};function m(o){var i=o.appKey,c=o.assetType,m=o.assetId,y=o.parentAssetType,b=o.parentAssetId,d=o.queryParams,h=a([]),O=r(h,2),j=O[0],g=O[1],v=a(!0),w=r(v,2),P=w[0],x=w[1];return s((function(){function r(){return(r=n(t.mark((function r(){var n;return t.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,p(c)(u(u(u({},f(c)),{},e({per_page:1e4},y,b),i&&{app_key:i}),d));case 2:n=r.sent,g(n.data.map(l)),x(!1);case 5:case"end":return r.stop()}}),r)})))).apply(this,arguments)}x(!0),function(){r.apply(this,arguments)}()}),[c,m,y,b,i]),{assets:j,loading:P}}function y(e){var c=e.appKey,m=e.assetType,y=e.companyId,b=e.currentValue,d=e.isMultiple,h=e.parentAssetId,O=e.parentAssetType,j=e.scrollPage,g=e.searchText,v=e.setCurrentOption,w=e.queryParams,P=a([]),x=r(P,2),k=x[0],A=x[1],T=a(!1),_=r(T,2),D=_[0],I=_[1],C=o(),q=o();return s((function(){function e(){return(e=n(t.mark((function e(){var r;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(m)(u(u({},f(m)),{},{ids:d?b:[b]},w));case 2:r=e.sent,v((function(){if(d)return r.data.map(l);var e=r.data[0];return e?l(e):null}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(d?b.length:b)&&function(){e.apply(this,arguments)}()}),[]),s((function(){function e(){return(e=n(t.mark((function e(){var r,n,a,s,o;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I(!0),r={per_page:i,page:j},O&&h&&(r[O]=h),y&&(r.company=y),g&&(r.search=g),c&&(r.app_key=c),n=p(m)(u(u(u({},f(m)),r),w)),q.current=n,e.next=11,n;case 11:if(a=e.sent,q.current===n){e.next=14;break}return e.abrupt("return");case 14:s=a.data.map(l),o=C.current!==m||1===j,A(o?s:function(e){return e.concat(s)}),C.current=m,e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),console.error(e.t0);case 23:I(!1);case 24:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[m,O,h,y,g,j,c]),{assets:k,loading:D}}export{y as useAssetAutoCompleteSelectData,m as useAssetSelectData};
