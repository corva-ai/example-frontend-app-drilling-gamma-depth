import e from"@babel/runtime/helpers/defineProperty";import{omit as t,get as n}from"lodash";import i from"@babel/runtime/helpers/slicedToArray";import{jsxs as a,jsx as r,Fragment as o}from"react/jsx-runtime";import{Popover as l,Typography as c,CircularProgress as s,Tooltip as m,List as p,ListItem as d,TextField as u,IconButton as f}from"@material-ui/core";import{useState as h,useEffect as g,useMemo as N,Fragment as y}from"react";import S from"prop-types";import T from"classnames";import{Check as v,LayersClear as b,AddCircle as O,Layers as C,Close as E,Delete as I,Edit as R,FileCopy as P,Share as q}from"@material-ui/icons";import D from"../TemplateSharingDialog/index.js";import{useTemplatePopoverStyles as j}from"./Styles.js";var k,L;function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function w(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?z(Object(i),!0).forEach((function(n){e(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):z(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var U="USER",A="DEFAULT",B="SHARED",W=(e(k={},U,"No templates yet..."),e(k,A,"No templates yet..."),e(k,B,"No shared templates yet..."),k),x=(e(L={},U,"My Template"),e(L,A,"Default Templates"),e(L,B,"Shared With Me"),L);function F(S){var k,L=S.currentUser,z=S.open,F=S.anchorEl,G=S.anchorOrigin,M=S.transformOrigin,H=S.onClose,K=S.templates,J=S.activeTemplateId,Q=S.getDefaultTemplates,V=S.getUserTemplates,X=S.getSharedTemplates,Y=S.onAddNewTemplate,Z=S.onTemplateDelete,$=S.onTemplateCopy,_=S.onTemplateEdit,ee=S.onTemplateShare,te=S.onActiveTemplateChange,ne=S.loading,ie=S.classes,ae=S.hasNameSlot,re=S.renderSlot,oe=j(),le=h(K),ce=i(le,2),se=ce[0],me=ce[1],pe=h(null),de=i(pe,2),ue=de[0],fe=de[1],he=h({}),ge=i(he,2),Ne=ge[0],ye=ge[1];g((function(){me(K)}),[K]);var Se=N((function(){return[{type:U,templatesList:V(se)},{type:A,templatesList:Q(se)},{type:B,templatesList:X(se)}]}),[se]),Te=function(e){return function(){te(e)}},ve=function(e,t){return function(n){n.stopPropagation(),t(e)}},be=function(e){return function(t){t.stopPropagation(),me(se.map((function(t){return t.id===e?w(w({},t),{},{isEditing:!0,prevName:t.name}):t})))}},Oe=function(e){return function(n){n.stopPropagation(),me(se.map((function(t){return t.id===e?w(w({},t),{},{isEditing:!1}):t})));var i=se.find((function(t){return t.id===e}));_(t(i,["prevName","isEditing"]))}},Ce=function(e){return function(t){t.stopPropagation(),me(se.map((function(t){return t.id===e?w(w({},t),{},{name:t.prevName,isEditing:!1}):t})))}},Ee=function(e){return function(n){if("Enter"===n.key){me(se.map((function(t){return t.id===e?w(w({},t),{},{isEditing:!1}):t})));var i=se.find((function(t){return t.id===e}));_(t(i,["prevName","isEditing"]))}}},Ie=function(e){return function(t){t.stopPropagation();var n=se.find((function(t){return t.id===e}));fe(n)}},Re=function(){fe(null)};return a(l,{id:"app-settings-template-popper",classes:{paper:T(oe.paper,ie.paper)},open:z,anchorEl:F,onClose:H,anchorOrigin:G,transformOrigin:M,children:[a("div",{className:oe.paperWrapper,children:[a("div",{className:oe.titleWrapper,children:[r(c,{className:oe.title,children:"Templates"}),ne&&r(s,{size:16})]}),r("div",{className:T(oe.selectedGroup,(k={},e(k,oe.selectedGroupSelected,-100===J),e(k,oe.selectedGroupUnSelected,-100!==J),k)),onClick:Te(-100),children:a("div",{className:oe.noTemplateItem,children:[r(-100===J?v:b,{fontSize:"small",className:oe.selectedIcon}),r("div",{className:oe.selectedLabel,children:"No Template Selected"})]})}),Se.map((function(t){var i=t.type,l=t.templatesList;return a(y,{children:[a("div",{className:oe.templateHeader,children:[r(c,{className:oe.subtitle,children:x[i]}),i===U&&r(m,{title:"Create Template",placement:"right",children:r(O,{fontSize:"small",color:"primary",className:oe.addNewTemplateIcon,onClick:Y})})]}),0===l.length?r(c,{className:oe.noTemplateLabel,children:W[i]}):r(p,{className:oe.templateList,children:l.map((function(t){var l,s;return a(d,{className:T(oe.templateListItem,(l={},e(l,oe.templateListItemSelected,t.id===J),e(l,oe.templateListItemUnSelected,t.id!==J),l)),onClick:Te(t.id),children:[t.id===J?r(v,w({fontSize:"small"},t.isEditing&&{color:"primary"})):r(C,w({fontSize:"small"},t.isEditing&&{color:"primary"})),t.isEditing?r(u,{autoFocus:!0,className:oe.templateListItemInput,value:t.name,onClick:function(e){return e.stopPropagation()},onChange:(s=t.id,function(t){t.stopPropagation(),se.filter((function(e){return e.id!==s})).map((function(e){return e.name})).includes(t.target.value)?ye(w(w({},Ne),{},e({},s,"Duplicated name"))):ye(w(w({},Ne),{},e({},s,null))),me(se.map((function(e){return e.id===s?w(w({},e),{},{name:t.target.value}):e})))}),onKeyDown:Ee(t.id),error:!!Ne[t.id],helperText:Ne[t.id]}):r(c,{className:oe.templateListItemName,children:t.name}),t.isEditing?null:ae&&re(n(t,["settings","data"],[])),t.isEditing?a("div",{className:T(oe.actionWrapper,oe.actionWrapperEditing),children:[r(m,{title:"Save",children:r(f,{className:oe.actionIconButton,onClick:Oe(t.id),children:r(v,{fontSize:"small",color:"primary"})})}),r(m,{title:"Cancel",children:r(f,{className:oe.actionIconButton,onClick:Ce(t.id),children:r(E,{className:oe.actionIcon,fontSize:"small"})})})]}):r("div",{className:oe.actionWrapper,children:i===U?a(o,{children:[r(m,{title:"Delete",children:r(f,{className:oe.actionIconButton,onClick:ve(t.id,Z),children:r(I,{className:oe.actionIcon,fontSize:"small"})})}),r(m,{title:"Rename",children:r(f,{className:oe.actionIconButton,onClick:be(t.id),children:r(R,{className:oe.actionIcon,fontSize:"small"})})}),r(m,{title:"Copy",children:r(f,{className:oe.actionIconButton,onClick:ve(t.id,$),children:r(P,{className:oe.actionIcon,fontSize:"small"})})}),r(m,{title:"Share",children:r(f,{className:oe.actionIconButton,onClick:Ie(t.id),children:r(q,{className:oe.actionIcon,fontSize:"small"})})})]}):r(m,{title:"Copy To My Templates",children:r(f,{className:oe.actionIconButton,onClick:ve(t.id,$),children:r(P,{className:oe.actionIcon,fontSize:"small"})})})})]},"template-list-item-".concat(t.id))}))})]},"template-list-".concat(i))}))]}),r(D,{title:'Share "'.concat(n(ue,"name"),'"'),open:!!ue,onSave:function(e){ue&&ee(ue.id,e),Re()},onCancel:Re,currentUser:L})]})}F.propTypes={open:S.bool.isRequired,anchorEl:S.node,anchorOrigin:S.shape({}),transformOrigin:S.shape({}),onClose:S.func.isRequired,templates:S.arrayOf(S.shape({id:S.number,name:S.string,settings:S.shape({}),shared:S.bool})).isRequired,activeTemplateId:S.number.isRequired,getDefaultTemplates:S.func.isRequired,getUserTemplates:S.func.isRequired,getSharedTemplates:S.func.isRequired,onAddNewTemplate:S.func.isRequired,onTemplateDelete:S.func.isRequired,onTemplateCopy:S.func.isRequired,onTemplateEdit:S.func.isRequired,onTemplateShare:S.func.isRequired,onActiveTemplateChange:S.func.isRequired,loading:S.bool,classes:S.shape({paper:S.string}),hasNameSlot:S.bool,renderSlot:S.func.isRequired,currentUser:S.shape({}).isRequired},F.defaultProps={loading:!1,classes:{},hasNameSlot:!1,anchorEl:null,anchorOrigin:{},transformOrigin:{}};export default F;
