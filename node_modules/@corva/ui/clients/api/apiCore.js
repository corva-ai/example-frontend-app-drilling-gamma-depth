import t from"@babel/runtime/helpers/defineProperty";import e from"@babel/runtime/helpers/slicedToArray";import r from"@babel/runtime/helpers/classCallCheck";import n from"@babel/runtime/regenerator";import a from"@babel/runtime/helpers/asyncToGenerator";import{parse as o,stringify as s}from"query-string";import i from"@babel/runtime/helpers/createClass";import{getDCAppKey as c}from"../utils.js";import{removeAuthToken as p,getAuthToken as u}from"../clientStorage/index.js";import{DISPLAY_HTTP_MESSAGES as l}from"./httpMessages.js";function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?h(Object(n),!0).forEach((function(r){t(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={400:"Request Failed",403:"No Permission",404:"Not Found"},m=["POST","PUT","PATCH","DELETE"],y=function(){function t(e,n){r(this,t),this.status=e.status,this.statusText=e.statusText,this.message=n.message||"No Message"}return i(t,[{key:"isAuthenticationProblem",value:function(){return 401===this.status||"Invalid authentication token"===this.message}},{key:"isTermsProblem",value:function(){return 401===this.status&&"Please accept the latest terms of service"===this.message}}]),t}(),v=o(window.location.search).api_url||process.env.REACT_APP_API_URL||"https://api.qa.corva.ai",b={"Content-Type":"application/json",Accept:"application/json"};function g(t){var e=t.config,r=t.appKey,n=u();return n?f(f({},e),{},{headers:f(f({},e.headers||{}),{},{Authorization:"Bearer ".concat(n),"X-Corva-App":r})}):e}function w(t){t.isAuthenticationProblem&&t.isAuthenticationProblem()&&!t.isTermsProblem()&&(p(),console.error("Problem with user"),"/login"!==window.location.pathname&&(window.location.href="/login"))}var P=/^\/v1\/assets.*/;function x(){return(x=a(n.mark((function t(e){var r,a,o,s,i,c=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:{},a=c.length>2&&void 0!==c[2]?c[2]:{},o=a.apiUrl,s=void 0===o?v:o,i=a.appKey,P.test(e)&&(r.cache="reload"),t.abrupt("return",fetch("".concat(s).concat(e),g({config:r,appKey:i})));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var j,O,k=(j=function(t){return x.apply(this,arguments)},O=a(n.mark((function t(e,r,a){var o,s,i,c,p,u,h;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j(e,r,a);case 2:if(o=t.sent,s=o.status,!o.ok){t.next=6;break}return t.abrupt("return",204===s?null:o);case 6:return t.prev=6,t.next=9,o.json();case 9:i=t.sent,t.next=15;break;case 12:t.prev=12,t.t0=t.catch(6),i={};case 15:throw c=r.method,p=m.includes(c),u=l[i.message]||d[s],p&&u&&console.error("ERROR"),w(h=new y(o,i)),h;case 22:case"end":return t.stop()}}),t,null,[[6,12]])}))),function(t,e,r){return O.apply(this,arguments)});function T(t,e){return A.apply(this,arguments)}function A(){return(A=a(n.mark((function t(e,r){var a,o,s,i=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:{},o=a.apiUrl,t.next=4,k(e,{method:"POST",headers:b,body:JSON.stringify(r)},{apiUrl:o,appKey:c()});case 4:return s=t.sent,t.abrupt("return",s&&s.json());case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function U(t){return E.apply(this,arguments)}function E(){return(E=a(n.mark((function t(e){var r,a,o,i,c,p,u=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:{},a=u.length>2&&void 0!==u[2]?u[2]:{},o=a.apiUrl,i=a.appKey,c=s(r,{arrayFormat:"bracket"}),t.next=6,k("".concat(e).concat(c?"?":"").concat(c),{method:"GET"},{apiUrl:o,appKey:i});case 6:if(p=t.sent,t.t0=p,!t.t0){t.next=12;break}return t.next=11,p.json();case 11:t.t0=t.sent;case 12:return t.t1=t.t0,t.t2=p&&p.headers,t.abrupt("return",{data:t.t1,headers:t.t2});case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(t){return S.apply(this,arguments)}function S(){return(S=a(n.mark((function t(e){var r,a,o,s=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},a=s.length>2&&void 0!==s[2]?s[2]:{},t.next=4,U(e,r,f(f({},a),{},{appKey:a.appKey||c()}));case 4:return o=t.sent,t.abrupt("return",o.data);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(t,e){return D.apply(this,arguments)}function D(){return(D=a(n.mark((function t(e,r){var a,o,i,p,u,l=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>2&&void 0!==l[2]?l[2]:{},o=l.length>3&&void 0!==l[3]?l[3]:{},i=o.apiUrl,p=s(a),t.next=6,k("".concat(e).concat(p?"?":"").concat(p),{method:"PUT",headers:b,body:JSON.stringify(r)},{apiUrl:i,appKey:c()});case 6:return u=t.sent,t.abrupt("return",u&&u.json());case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function N(t,e){return R.apply(this,arguments)}function R(){return(R=a(n.mark((function t(e,r){var a,o,i,p,u,l=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>2&&void 0!==l[2]?l[2]:{},o=l.length>3&&void 0!==l[3]?l[3]:{},i=o.apiUrl,p=s(a),t.next=6,k("".concat(e).concat(p?"?":"").concat(p),{method:"PATCH",headers:b,body:JSON.stringify(r)},{apiUrl:i,appKey:c()});case 6:return u=t.sent,t.abrupt("return",u&&u.json());case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function F(t){return _.apply(this,arguments)}function _(){return(_=a(n.mark((function t(e){var r,a,o,i,p,u=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:{},a=u.length>2&&void 0!==u[2]?u[2]:{},o=a.apiUrl,i=s(r),t.next=6,k(i?"".concat(e,"?").concat(i):e,{method:"DELETE",headers:b},{apiUrl:o,appKey:c()});case 6:return p=t.sent,t.abrupt("return",p&&p.json());case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function q(t,e){return J.apply(this,arguments)}function J(){return(J=a(n.mark((function t(r,a){var o,i,p,u,l,h,f,d=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=d.length>2&&void 0!==d[2]?d[2]:{},i=d.length>3&&void 0!==d[3]?d[3]:{},p=s(o),u=i.method,l=void 0===u?"POST":u,h=new FormData,Object.entries(a).forEach((function(t){var r=e(t,2),n=r[0],a=r[1];Array.isArray(a)?a.forEach((function(t){h.append(n,t)})):h.append(n,a)})),t.next=8,k(p?"".concat(r,"?").concat(p):r,{method:l,headers:{Accept:"application/json"},body:h},{appKey:c()});case 8:return f=t.sent,t.abrupt("return",f&&f.json());case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}export{v as baseUrl,F as del,K as get,U as getWithHeaders,w as handleAuthenticationProblem,N as patch,T as post,C as put,q as sendFormData};
