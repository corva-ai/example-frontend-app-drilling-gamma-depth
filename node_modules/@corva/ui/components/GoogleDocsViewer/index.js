import e from"@babel/runtime/helpers/defineProperty";import r from"@babel/runtime/helpers/classCallCheck";import o from"@babel/runtime/helpers/createClass";import{jsxs as t,jsx as i}from"react/jsx-runtime";import{createRef as n,PureComponent as a}from"react";import l from"prop-types";import s from"classnames";import c from"@babel/runtime/helpers/assertThisInitialized";import f from"@babel/runtime/helpers/inherits";import m from"@babel/runtime/helpers/possibleConstructorReturn";import u from"@babel/runtime/helpers/getPrototypeOf";import p from"../LoadingIndicator/LoadingIndicator.js";import d from"@material-ui/core/Typography";import h from"@material-ui/icons/ArrowBack";import b from"./styles.css.js";function g(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,t=u(e);if(r){var i=u(this).constructor;o=Reflect.construct(t,arguments,i)}else o=t.apply(this,arguments);return m(this,o)}}var v=function(e){return i("div",{className:b.cGoogleDocsViewerToolbar,children:i("button",{type:"button","aria-label":"Close",className:b.cGoogleDocsViewerToolbarButton,onClick:e.onClose,children:t("div",{className:b.cGoogleDocsViewerToolbarBackButton,children:[i(h,{className:b.cGoogleDocsViewerToolbarIcon,htmlColor:"#b3b3b3"}),e.fileName&&i("span",{className:b.cGoogleDocsViewerToolbarBackButtonFileName,children:e.fileName})]})})})},y=function(l){f(u,a);var m=g(u);function u(o){var t;return r(this,u),t=m.call(this,o),e(c(t),"reloadFrame",(function(){t.frameRef.current&&t.setState((function(e){return{reloadsCounter:e.reloadsCounter+1}}),(function(){t.frameRef.current.src=t.frameLink}))})),e(c(t),"onFrameLoad",(function(){t.setState({loading:!1},(function(){clearInterval(t.frameLoadInterval)}))})),t.state={reloadsCounter:0,loading:!0,loadingFailed:!1},t.frameRef=n(),t}return o(u,[{key:"componentDidMount",value:function(){var e=this.props.fileSize&&this.props.fileSize>=1048576?this.props.fileSize/1048576*1e4:1e4;this.frameLoadInterval=setInterval(this.reloadFrame,e)}},{key:"componentWillUnmount",value:function(){clearInterval(this.frameLoadInterval)}},{key:"render",value:function(){var r=this.props,o=r.fileUrl,n=r.width,a=r.height,l=r.fileName,c=r.onClose,f=this.state,m=f.loading,u=f.loadingFailed;return t("div",{className:b.cGoogleDocsViewer,style:{width:n,height:a},children:[i(v,{fileName:l,onClose:c}),m&&i(p,{white:!1}),u?i(d,{variant:"body2",children:"Loading failed"}):i("iframe",{className:s(b.cGoogleDocsViewerFrame,e({},b.cGoogleDocsViewerFrameHidden,m)),title:o,src:this.frameLink,onLoad:this.onFrameLoad,ref:this.frameRef})]})}},{key:"frameLink",get:function(){return"https://docs.google.com/viewer?url=".concat(encodeURIComponent(this.props.fileUrl),"&embedded=true")}}]),u}();y.propTypes={width:l.oneOfType([l.string,l.number]),height:l.oneOfType([l.string,l.number]),fileUrl:l.string.isRequired,fileName:l.string,fileSize:l.number,onClose:l.func.isRequired},v.propTypes={onClose:l.func.isRequired,fileName:l.string},y.defaultProps={width:"100%",height:"100%",fileName:void 0,fileSize:void 0},v.defaultProps={fileName:void 0};export default y;
