import e from"@babel/runtime/helpers/defineProperty";import{round as n,throttle as r}from"lodash";import t from"@babel/runtime/helpers/slicedToArray";import{jsx as i,jsxs as a}from"react/jsx-runtime";import{useState as o,useRef as l,useEffect as u}from"react";import m from"prop-types";import s from"classnames";import c from"./RangeSlider.css.js";import{calculatePercentForValue as p,updateFromValue as d,updateToValue as g,calculateValueFromPercent as f}from"./utils.js";import{horizontalStrategy as I}from"./strategies/horizontal.js";import{verticalStrategy as R}from"./strategies/vertical.js";import{RangeSliderControl as v,RangeSliderOrientation as T}from"./constants.js";import O from"./inputs/FromInput.js";import C from"./inputs/ToInput.js";var S=function(m){var S=m.min,h=m.max,N=m.from,V=m.to,A=m.minRange,L=m.onChange,y=m.orientation,b=m.precision,B=o(null),M=t(B,2),x=M[0],E=M[1],F=o(null),P=t(F,2),H=P[0],w=P[1],j=o(null),z=t(j,2),U=z[0],Z=z[1],_=o(null),D=t(_,2),q=D[0],X=D[1],Y=o(v.FROM),k=t(Y,2),G=k[0],J=k[1],K=o({}),Q=t(K,2),W=Q[0],$=Q[1],ee=l(null),ne=l(null),re=l(null),te=l(null),ie=l(null);u((function(){y===T.HORIZONTAL&&Z(I),y===T.VERTICAL&&Z(R)}),[y]),u((function(){if(U){var r,t=n(N,b),i=n(V,b),a=n(S,b),o=n(h,b),l=p(t,a,o),u=p(i,a,o),m={};te.current&&ie.current&&(m=U.calculateInputSpacing(l,u,ee,te,ie)),y===T.HORIZONTAL&&X(m.isNotEnoughInputSpace),$((e(r={},v.FROM,U.getThumbStyles(l,G===v.FROM)),e(r,v.TO,U.getThumbStyles(u,G===v.TO)),e(r,v.BAR,U.getBarStyles(l,u)),e(r,v.FROM_INPUT,U.getInputStyles(l)),e(r,v.TO_INPUT,U.getInputStyles(u)),e(r,v.COMPACT_INPUTS,U.getInputStyles((l+u)/2)),r)),E(t.toString()),w(i.toString())}}),[U,S,h,N,V]);var ae=function(e){var r=U.getCoordinates(e,ee.current.getBoundingClientRect()),t=p(r.new,r.min,r.max),i=n(f(t,S,h),b);if(i!==N){var a=d(i,N,V,S,A);L(a)}},oe=function(e){var r=U.getCoordinates(e,ee.current.getBoundingClientRect()),t=p(r.new,r.min,r.max),i=n(f(t,S,h),b);if(i!==V){var a=g(i,N,V,h,A);L(a)}},le=function(e,r){var t=U.getBarCoordinates(e,r,ee.current.getBoundingClientRect()),i=p(t.new,t.min,t.max),a=n(f(i,S,h),b),o=n(V+(a-N),b);if(a<S){var l=S-a;a=S,o=n(o+l,b)}if(o>h){var u=o-h;o=h,a=n(a-u,b)}a!==N&&o!==V&&a>=S&&o<=h&&L({from:a,to:o})},ue=function(e,n){n.stopPropagation(),J(e);var t=n.clientX,i=n.clientY,a=n.target.getBoundingClientRect(),o=a.x,l=a.y;var u=r((function(n){!function(e){return e===v.FROM?ae:e===v.TO?oe:le}(e)(n,{clientX:t,clientY:i,x:o,y:l})}),4);document.addEventListener("mousemove",u),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",e)}))},me=function(e,n){var r=n.target.value;Number.isNaN(r)||function(e){return e===v.FROM?E:w}(e)(r)},se=function(e,r){var t=r.target.value,i=n(t,b);if(e===v.FROM){var a=d(i,N,V,S,A);L(a)}if(e===v.TO){var o=g(i,N,V,h,A);L(o)}};return i("div",{className:s(y===T.HORIZONTAL&&c.rangeSliderHorizontal,y===T.VERTICAL&&c.rangeSliderVertical),children:a("div",{className:s(c.rangeSliderRail,y===T.HORIZONTAL&&c.rangeSliderRailHorizontal,y===T.VERTICAL&&c.rangeSliderRailVertical),ref:ee,children:[i("div",{ref:ne,className:c.rangeSliderThumb,style:W[v.FROM],onMouseDown:function(e){return ue(v.FROM,e)},children:i("div",{className:c.rangeSliderLabel})}),i("div",{className:s(c.rangeSliderBar,y===T.HORIZONTAL&&c.rangeSliderBarHorizontal,y===T.VERTICAL&&c.rangeSliderBarVertical),style:W[v.BAR],onMouseDown:function(e){return ue(v.BAR,e)},children:i("div",{className:s(c.rangeSliderBarView,y===T.HORIZONTAL&&c.rangeSliderBarViewHorizontal,y===T.VERTICAL&&c.rangeSliderBarViewVertical)})}),i("div",{ref:re,className:c.rangeSliderThumb,style:W[v.TO],onMouseDown:function(e){return ue(v.TO,e)},children:i("div",{className:c.rangeSliderLabel})}),!q&&i(O,{compStyles:W[v.FROM_INPUT],isVerticalOrientation:y===T.VERTICAL,max:h,precision:b,fromInputRef:te,from:N,fromInputValue:x,onInputChange:me,validateInputChange:se}),!q&&i(C,{compStyles:W[v.TO_INPUT],isVerticalOrientation:y===T.VERTICAL,max:h,precision:b,toInputRef:ie,to:V,toInputValue:H,onInputChange:me,validateInputChange:se}),q&&a("div",{className:c.rangeSliderCompactInputs,style:W[v.COMPACT_INPUTS],children:[i(O,{isVerticalOrientation:y===T.VERTICAL,max:h,precision:b,fromInputRef:te,from:N,fromInputValue:x,onInputChange:me,validateInputChange:se}),i("span",{className:c.rangeSliderInputDivider,children:"-"}),i(C,{isVerticalOrientation:y===T.VERTICAL,max:h,precision:b,toInputRef:ie,to:V,toInputValue:H,onInputChange:me,validateInputChange:se})]})]})})};S.propTypes={min:m.number,max:m.number,from:m.number.isRequired,to:m.number.isRequired,orientation:m.string,precision:m.number,minRange:m.number,onChange:m.func},S.defaultProps={min:0,max:100,orientation:"horizontal",precision:0,minRange:0,onChange:function(){}};export default S;
