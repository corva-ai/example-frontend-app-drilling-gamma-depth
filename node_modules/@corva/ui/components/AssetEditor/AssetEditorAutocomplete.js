import e from"@babel/runtime/helpers/defineProperty";import{debounce as t,identity as r}from"lodash";import n from"@babel/runtime/helpers/slicedToArray";import{jsxs as o,jsx as i}from"react/jsx-runtime";import{withStyles as a,List as l,FormControl as s,InputLabel as p,FormHelperText as u,Typography as d,TextField as c,InputAdornment as m,Chip as f}from"@material-ui/core";import{forwardRef as b,useState as y,useEffect as g,useMemo as h}from"react";import O from"@babel/runtime/helpers/objectWithoutProperties";import v from"prop-types";import{Search as x}from"@material-ui/icons";import T from"../TruncatedText/index.js";import{PER_PAGE as I,SCROLL_THRESHOLD as P}from"./constants.js";import{useAssetAutoCompleteSelectData as C}from"./effects/index.js";import{Autocomplete as j}from"@material-ui/lab";function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?A(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var M="DC_SingleAssetEditorAutocomplete",q={paddingLeft:"16px",height:36,listStyleType:"none",display:"flex",alignItems:"center"},w=function(e){var t=e.text;return i("li",{style:q,children:i(d,{variant:"body2",color:"textSecondary",children:void 0===t?"Loading...":t})},"loading")},L=b((function(e,t){var r=e.children,n=e.loading,a=e.hasMore,s=O(e,["children","loading","hasMore"]);return o(l,S(S({},s),{},{ref:t,role:"listbox",children:[r,(a||n)&&i(w,{})]}))})),D=function(e){var a=e["data-testid"],l=e.appKey,d=e.assetType,b=e.classes,O=e.companyId,v=e.currentValue,A=e.disabled,q=e.disableClearable,D=e.errorText,N=e.isMultiple,R=e.isNullable,V=e.label,E=e.onChange,K=e.parentAssetId,_=e.parentAssetType,k=e.queryParams,z=y(N?[]:null),H=n(z,2),B=H[0],W=H[1],F=y(""),G=n(F,2),J=G[0],Q=G[1],U=y(""),X=n(U,2),Y=X[0],Z=X[1],$=y(!1),ee=n($,2),te=ee[0],re=ee[1],ne=y(1),oe=n(ne,2),ie=oe[0],ae=oe[1],le=y(!0),se=n(le,2),pe=se[0],ue=se[1];g((function(){W(N?[]:null),ae(1),re(!1)}),[d]);var de=C({appKey:l,assetType:d,companyId:O,currentValue:v,isMultiple:N,parentAssetId:K,parentAssetType:_,scrollPage:ie,searchText:J,setCurrentOption:W,queryParams:k}),ce=de.assets,me=de.loading;g((function(){var e=ce.length>=I*ie;ue(e)}),[ce,ie]);var fe=h((function(){return t((function(e){ae(1),Q(e)}),200)}),[]),be=h((function(){return t((function(){return ae((function(e){return e+1}))}),250)}),[]),ye={endAdornment:b.endAdornment,inputRoot:b.inputRoot,listbox:b.listbox,noOptions:b.noOptions,option:b.option,popupIndicator:b.popupIndicator,root:b.root};return o(s,{disabled:A,error:!!D,className:b.formControl,children:[!R&&i(p,{shrink:!0,children:V}),i(j,S({disabled:A,blurOnSelect:!0,classes:ye,clearOnBlur:!0,clearOnEscape:!0,"data-testid":a,disableClearable:q,filterOptions:r,getOptionLabel:function(e){return null==e?void 0:e.name},getOptionSelected:function(e,t){return e&&t&&e.id===t.id},inputValue:te?Y:(null==B?void 0:B.name)||"",ListboxComponent:L,ListboxProps:{onScroll:function(e){if(pe&&!me){var t=e.currentTarget;t.scrollTop+t.clientHeight>t.scrollHeight-P&&be()}},loading:me,hasMore:pe},options:ce,onChange:function(e,t){var r;W(t),E(N?t.map((function(e){return e.id})):null!==(r=null==t?void 0:t.id)&&void 0!==r?r:null,t)},onClose:function(){Z(""),Q(""),re(!1),ae(1)},onInputChange:function(e,t,r){"input"===r?(Z(t),re(!0),fe(t)):Q("")},noOptionsText:i(w,{text:me?"Loading...":"No options"}),renderInput:function(e){return i(c,S(S({},e),{},{variant:"standard",placeholder:"Search for asset..."},!N&&{InputProps:S(S({},e.InputProps),{},{startAdornment:i(m,{children:i(x,{className:b.searchIcon})})})}))},renderOption:function(e){var t=e.id,r=e.name;return i(T,{"data-testid":"".concat(M,"_option_").concat(r,"MenuItem"),children:N&&v.includes(t)?"".concat(r," (already selected)"):r},t)},value:B,multiple:N},N&&{renderTags:function(e,t){return e.map((function(e,r){return i(f,S({label:null==e?void 0:e.name},t({index:r})),e.id)}))},getOptionDisabled:function(e){return v.includes(e.id)}})),i(u,{children:D})]})};D.defaultProps={label:"Choose An Asset",currentValue:void 0,disableClearable:!0,isNullable:!1,parentAssetId:void 0,parentAssetType:void 0,companyId:void 0,errorText:"","data-testid":"".concat(M,"_autoComplete"),disabled:!1,isMultiple:!1,appKey:null,queryParams:{}},D.propTypes={label:v.string,currentValue:v.oneOfType([v.number,v.arrayOf(v.number)]),isNullable:v.bool,onChange:v.func.isRequired,classes:v.shape({}).isRequired,disableClearable:v.bool,parentAssetId:v.number,parentAssetType:v.string,companyId:v.number,assetType:v.string.isRequired,errorText:v.string,"data-testid":v.string,disabled:v.bool,isMultiple:v.bool,appKey:v.string,queryParams:v.shape({})};var N=a((function(e){return{formControl:{},listbox:{maxHeight:350},root:{fontSize:16},inputRoot:{paddingTop:16,padding:"8px 0",paddingBottom:0,width:350,fontSize:16},popupIndicator:{display:"none"},option:{paddingLeft:"16px !important",height:36,"&[aria-disabled=true]":{color:e.palette.primary.text9,opacity:1,backgroundColor:"unset"}},noOptions:{padding:0},searchIcon:{fontSize:"20px !important"}}}))(D);export default N;
