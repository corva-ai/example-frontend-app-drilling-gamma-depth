import{get as r}from"lodash";import{mapbox as e}from"../../../../utils/index.js";import{jsx as t}from"react/jsx-runtime";import o from"mapbox.js";import{memo as n,useRef as l,useMemo as u,useEffect as c,createElement as i}from"react";import a from"prop-types";import s from"react-dom";import{usePrevious as f}from"../../effects/index.js";import m from"./Map.css.js";var d=e.isValidCoordinates,p=[29.749907,-95.358421];function h(e){var n=e.subjectWell,a=e.wells,h=e.offsetWells,v=e.radius,b=e.subjectWellMarkerSize,k=e.wellMarkerSize,y=e.coordsDataPath,g=l(null),j=l(null),x=l(null),C=l(null),M=f(a),W=u((function(){return n&&r(n,y)}),[n,y]);c((function(){g.current=o.mapbox.map(g.current,null,{attributionControl:!1,scrollWheelZoom:!1,zoomControl:!1}).setView(p,1),o.control.zoom({position:"bottomright"}).addTo(g.current),o.mapbox.styleLayer("mapbox://styles/mapbox/dark-v9").addTo(g.current)}),[]),c((function(){g.current&&(j.current&&g.current.removeLayer(j.current),W?(j.current=o.circle(W,1609.34*v,{stroke:!1,fill:!0,fillOpacity:.2,fillColor:"#03BCD4",className:"circle_500"}),j.current.addTo(g.current)):j.current=null)}),[v,W]);return c((function(){if(g.current){g.current.closePopup(),x.current&&x.current.removeFrom(g.current);var e=h.map((function(r){return r.id})),l=[];a.forEach((function(u){var c=r(u,y);if(c&&d(c)){var a=n&&n.id===u.id,f=e.includes(u.id),m=a?b:k,p=a||f?1:.3,h=o.circleMarker(c,{radius:m,stroke:!1,fill:!0,fillOpacity:p,fillColor:"#FFC107",className:"circle_500"});h.addEventListener("mouseover",(function(){var e=document.createElement("div"),n=i((function(e){var o=e.well;return t("div",{style:{color:"#fff",background:"##414141"},children:t("span",{style:{fontSize:"11px",lineHeight:"16px"},children:r(o,"name")})})}),{well:u});s.render(n,e),o.popup().setLatLng(c).setContent(e).openOn(g.current),function(r,e,t){C.current=o.circleMarker(e,{radius:3*t,stroke:!1,fill:!0,fillOpacity:.2,fillColor:"#FFC107",className:"circle_highlight"}),C.current.addEventListener("mouseout",(function(){x.current.removeFrom(g.current),x.current=o.featureGroup(r),x.current.addTo(g.current),g.current.closePopup()}));var n=r.concat(C.current);x.current=o.featureGroup(n),x.current.addTo(g.current)}(l,c,m)})),l.push(h)}})),l.length&&(x.current=o.featureGroup(l),x.current.addTo(g.current)),setTimeout((function(){j.current&&j.current.bringToBack(),g.current&&x.current&&a!==M&&g.current.fitBounds(x.current.getBounds())}),500)}}),[n,a,h]),t("div",{className:m.map,children:t("div",{className:m.mapMain,ref:g})})}h.propTypes={subjectWell:a.shape({id:a.number,formation:a.string}),wells:a.arrayOf(a.shape({})).isRequired,offsetWells:a.arrayOf(a.shape({})),radius:a.number.isRequired,subjectWellMarkerSize:a.number,wellMarkerSize:a.number,coordsDataPath:a.string},h.defaultProps={subjectWell:null,subjectWellMarkerSize:8,wellMarkerSize:5,coordsDataPath:"settings.top_hole.coordinates",offsetWells:null};var v=n(h);export default v;
