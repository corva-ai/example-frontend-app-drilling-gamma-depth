import e from"@babel/runtime/helpers/defineProperty";import t from"@babel/runtime/helpers/classCallCheck";import i from"@material-ui/core/colors/grey";import a from"../../utils/main.js";import{isNativeDetected as o}from"../../utils/mobileDetect.js";import r from"@babel/runtime/helpers/createClass";import{jsx as s,jsxs as l,Fragment as n}from"react/jsx-runtime";import{Dialog as m}from"@material-ui/core";import{PureComponent as c}from"react";import{getFileDownloadLink as p}from"../../clients/jsonApi/index.js";import h from"prop-types";import{withStyles as d}from"@material-ui/core/styles";import u from"@babel/runtime/helpers/assertThisInitialized";import f from"@babel/runtime/helpers/inherits";import g from"@babel/runtime/helpers/possibleConstructorReturn";import v from"@babel/runtime/helpers/getPrototypeOf";import b from"@material-ui/core/Typography";import I from"@material-ui/core/IconButton";import w from"file-extension";import x from"image-extensions";import N from"../FileTypeIcon.js";import y from"video-extensions";import L from"react-player";import O from"@material-ui/icons/Image";import P from"@material-ui/icons/SaveAlt";import S from"@material-ui/icons/Fullscreen";import U from"../ImageViewer/index.js";import R from"../GoogleDocsViewer/index.js";import C from"./styles.css.js";function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,a=v(e);if(t){var o=v(this).constructor;i=Reflect.construct(a,arguments,o)}else i=a.apply(this,arguments);return g(this,i)}}var A=i[200],F=i[400],W=i[600],D={label:"small",value:135},j={label:"medium",value:300},k={fileImage:function(e,t){return{maxWidth:"100%",borderRadius:4,overflow:"hidden",maxHeight:t===D.label?D.value:j.value,display:e?"initial":"none",cursor:"pointer"}},fileDownloadWrapper:{marginTop:10,padding:"10px 10px 10px 5px",border:"1px solid ".concat(W),borderRadius:3,maxWidth:500,width:"75%"},imagePlaceholder:{position:"relative",backgroundColor:A,borderRadius:3,marginTop:10,height:135,width:135}},E=function(e){return l(n,{children:[l("div",{onClick:e.openLightbox,className:C.cAttachmentImg,children:[s("img",{"data-testid":"".concat("attachment","_preview"),src:e.attachmentUrl,style:k.fileImage(e.imageIsLoaded,e.size),alt:"Attachment",onLoad:e.setImageIsLoaded}),s("div",{className:C.cAttachmentImgPreviwBtn,children:s(S,{})})]}),!e.imageIsLoaded&&s("div",{style:k.imagePlaceholder,children:s(O,{className:e.classes.imageIconRoot,htmlColor:F,fontSize:"large"})}),e.lightboxIsOpen&&s(U,{mainSrc:e.attachmentUrl,imagePadding:50,onAfterOpen:e.handleLightboxOpen,onCloseRequest:e.handleLightboxClose})]})},T=function(e){return l("div",{className:C.cAttachmentFileWrapper,children:[l("div",{className:C.cAttachmentFileDownloadWrapper,style:k.fileDownloadWrapper,onClick:e.openPreview,children:[s(N,{fileName:e.displayName||e.attachmentUrl,className:C.cAttachmentFileDownloadWrapperFileIcon,size:e.small?25:50}),s("div",{"data-testid":"".concat("attachment","_name"),className:C.cAttachmentFileDownloadWrapperFileName,children:s(b,{variant:"subtitle2",noWrap:!0,className:e.classes.fileName,children:a.getFileNameWithExtensionFromPath(e.displayName||e.attachmentUrl)})}),s(m,{open:e.previewIsOpen,onClose:e.closePreview,classes:{root:e.classes.dialogRoot,paper:e.isNative?e.classes.nativeDialog:e.classes.dialog},children:s(R,{fileUrl:e.attachmentUrl,fileName:a.getFileNameWithExtensionFromPath(e.displayName||e.attachmentUrl),fileSize:e.attachmentSize,onClose:e.closePreview,width:"100%",height:"100%"})})]}),s("a",{download:e.displayName,href:e.attachmentUrl,className:C.cAttachmentFileDownloadWrapperForm,children:s(I,{"data-testid":"".concat("attachment","_downloadButton"),type:"submit",children:s(P,{className:e.classes.downloadIcon})})})]})},V=function(i){f(o,c);var a=z(o);function o(i){var r;t(this,o),r=a.call(this,i),e(u(r),"preventIOSScroll",(function(e){return e.preventDefault()})),e(u(r),"handleLightboxOpen",(function(){r.props.isNative&&document.documentElement.addEventListener("touchmove",r.preventIOSScroll,{passive:!1})})),e(u(r),"handleLightboxClose",(function(){r.props.isNative&&document.documentElement.removeEventListener("touchmove",r.preventIOSScroll),r.setState({lightboxIsOpen:!1})})),e(u(r),"openLightbox",(function(){return r.setState({lightboxIsOpen:!0})})),e(u(r),"setImageIsLoaded",(function(){return r.setState({imageIsLoaded:!0})})),e(u(r),"openPreview",(function(){return r.setState({previewIsOpen:!0})})),e(u(r),"closePreview",(function(e){e.stopPropagation(),r.setState({previewIsOpen:!1})})),r.state={imageIsLoaded:!1,lightboxIsOpen:!1,previewIsOpen:!1};var s=w(i.displayName||i.attachmentUrl);return r.isImage=x.includes(s),r.isVideo=y.includes(s),r}return r(o,[{key:"render",value:function(){return this.isImage?s("div",{className:C.cAttachment,children:s(E,{size:this.props.size,openLightbox:this.openLightbox,attachmentUrl:this.attachmentUrl,setImageIsLoaded:this.setImageIsLoaded,imageIsLoaded:this.state.imageIsLoaded,lightboxIsOpen:this.state.lightboxIsOpen,handleLightboxOpen:this.handleLightboxOpen,handleLightboxClose:this.handleLightboxClose,classes:this.props.classes})}):this.isVideo&&L.canPlay(this.props.attachmentUrl)?s("div",{className:C.cAttachment,children:s(L,{className:C.cAttachmentReactPlayer,url:this.attachmentUrl,config:{file:{attributes:{preload:"metadata"}}},controls:!0,height:this.props.size===D.label?D.value:j.value,width:null})}):s("div",{className:C.cAttachment,children:s(T,{attachmentUrl:this.attachmentUrl,attachmentSize:this.props.attachmentSize,displayName:this.props.displayName,isNative:this.props.isNative,openPreview:this.openPreview,closePreview:this.closePreview,previewIsOpen:this.state.previewIsOpen,classes:this.props.classes,small:this.props.small})})}},{key:"attachmentUrl",get:function(){return this.props.fileName?p(this.props.fileName):this.props.attachmentUrl}}]),o}();V.propTypes={attachmentUrl:h.string.isRequired,attachmentSize:h.number,displayName:h.string,fileName:h.string,size:h.oneOf([D.label,j.label]),classes:h.shape({}).isRequired,isNative:h.bool,small:h.bool},V.defaultProps={displayName:null,fileName:null,attachmentSize:void 0,size:j.label,small:!1,isNative:o};var q=d((function(e){return{imageIconRoot:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},dialog:{width:"95%",height:"95%",maxWidth:"100%",position:"relative"},nativeDialog:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",margin:0},dialogRoot:{backgroundColor:"rgba(0, 0, 0, 0.85)"},fileName:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},downloadIcon:{color:W,"&:hover":{color:e.palette.common.white}}}}))(V);export default q;
