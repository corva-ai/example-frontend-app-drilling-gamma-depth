import r from"@babel/runtime/helpers/defineProperty";import{get as e,sortBy as t}from"lodash";import o from"@babel/runtime/helpers/slicedToArray";import"@babel/runtime/helpers/typeof";import{mapbox as n}from"../../../../utils/index.js";import{jsx as i,jsxs as a}from"react/jsx-runtime";import{darkTheme as c}from"../../../../config/theme/index.js";import"highcharts";import"highcharts/highcharts-more";import"highcharts-multicolor-series";import"highcharts/modules/solid-gauge";import"highcharts/modules/heatmap";import"highcharts/modules/boost";import"highcharts/modules/exporting";import"highcharts/modules/xrange";import"highcharts/modules/dumbbell";import"highcharts/modules/pattern-fill";import l from"mapbox.js";import"../../../../config/mapbox/index.js";import{memo as u,useRef as s,useMemo as m,useEffect as p,createElement as f}from"react";import d from"prop-types";import{MuiThemeProvider as h}from"@material-ui/core/styles";import b from"react-dom";import{usePrevious as g}from"../../effects/index.js";import F from"./Map.css.js";function v(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.push.apply(t,o)}return t}function y(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?v(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}var j=n.isValidCoordinates,O=["#FF00FF","#F5BD80","#FF0000","#0080FF","#FF8000","#58ACFA","#FA58F4","#40FF00","#4B8A08","#40FF00","#D8F781"],k=[29.749907,-95.358421];function x(n){var u=n.subjectWell,d=n.wells,v=n.offsetWells,x=n.radius,N=n.subjectWellMarkerSize,P=n.wellMarkerSize,w=n.popUpFormatter,B=n.coordsDataPath,S=s(null),W=s(null),C=s(null),D=g(d),T=m((function(){return d.filter((function(r){return!u||u.id!==r.id}))}),[u,d]),M=m((function(){return u&&e(u,B)}),[u,B]),z=m((function(){var e=[],o=!1;T.forEach((function(r){"Null"===r.formation?o=!0:u&&u.formation===r.formation||e.includes(r.formation)||e.push(r.formation)}));var n=u?[u.formation].concat(t(e)):t(e);o&&!n.includes("Null")&&n.push("Null");var i=n.reduce((function(e,t,o){return y(y({},e),{},r({},t,O[o%O.length]))}),{});return[n,i]}),[u,T]),L=o(z,2),E=L[0],I=L[1];return p((function(){S.current=l.mapbox.map(S.current,null,{attributionControl:!1,scrollWheelZoom:!1,zoomControl:!1}).setView(k,1),l.control.zoom({position:"bottomright"}).addTo(S.current),l.mapbox.styleLayer("mapbox://styles/mapbox/dark-v9").addTo(S.current)}),[]),p((function(){S.current&&(W.current&&S.current.removeLayer(W.current),M?(W.current=l.circle(M,1609.34*x,{stroke:!1,fill:!0,fillOpacity:.2,fillColor:"#03BCD4",className:"circle_500"}),W.current.addTo(S.current)):W.current=null)}),[x,M]),p((function(){if(S.current){S.current.closePopup(),C.current&&C.current.removeFrom(S.current);var r=v.map((function(r){return r.id})),t=[];d.forEach((function(o){var n=e(o,B);if(n&&j(n)){var a=u&&u.id===o.id,s=r.includes(o.id),m=a?N:P,p=a||s?"#00FFFF":I[o.formation],d=a||s?1:.3,g=l.circleMarker(n,{radius:m,stroke:!1,fill:!0,fillOpacity:d,fillColor:p,className:"circle_500"});g.addEventListener("mouseover",(function(){if(w){var r=document.createElement("div"),e=f(w,{well:o,color:I[o.formation]});b.render(i(h,{theme:c,children:e}),r),l.popup().setLatLng(n).setContent(r).openOn(S.current)}})),t.push(g)}})),t.length&&(C.current=l.featureGroup(t),C.current.addTo(S.current)),setTimeout((function(){W.current&&W.current.bringToBack(),S.current&&W.current&&d!==D&&S.current.fitBounds(W.current.getBounds(),{padding:[5,5]})}),500)}}),[u,d,v,I]),p((function(){setTimeout((function(){W.current&&W.current.bringToBack(),u?S.current&&W.current&&S.current.fitBounds(W.current.getBounds(),{padding:[5,5]}):S.current&&C.current&&S.current.fitBounds(C.current.getBounds())}),500)}),[x,u]),a("div",{className:F.map,children:[i("div",{className:F.mapMain,ref:S}),a("div",{className:F.mapFooter,children:[v&&a("div",{className:F.mapFooterItem,children:[i("div",{className:F.mapFooterItemSquare,style:{backgroundColor:"#00FFFF"}}),i("div",{className:F.mapFooterItemLabel,children:"Selected Offset Wells"})]}),E.map((function(r){return a("div",{className:F.mapFooterItem,children:[i("div",{className:F.mapFooterItemSquare,style:{backgroundColor:I[r]}}),i("div",{className:F.mapFooterItemLabel,children:r})]},r)}))]})]})}x.propTypes={subjectWell:d.shape({id:d.number,formation:d.string}),wells:d.arrayOf(d.shape({})).isRequired,offsetWells:d.arrayOf(d.shape({})),radius:d.number.isRequired,subjectWellMarkerSize:d.number,wellMarkerSize:d.number,popUpFormatter:d.func,coordsDataPath:d.string},x.defaultProps={subjectWell:null,subjectWellMarkerSize:10,wellMarkerSize:5,popUpFormatter:null,coordsDataPath:"settings.top_hole.coordinates",offsetWells:null};var N=u(x);export default N;
