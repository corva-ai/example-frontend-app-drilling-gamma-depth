import e from"@babel/runtime/helpers/defineProperty";import{get as r,mapValues as t,merge as n}from"lodash";import i from"@babel/runtime/helpers/slicedToArray";import{ASSET_TYPES as s}from"../../../../constants/assetTypes.js";import{isDevCenterApp as a}from"../../../../utils/devcenter.js";import o from"@babel/runtime/regenerator";import p from"@babel/runtime/helpers/asyncToGenerator";import{useState as u,useEffect as c}from"react";import{getAppAssetSpecificTypeId as l}from"./utils.js";import{resolveAppsDataForAssetDashboard as d,resolveAppsDataForGeneralDashboard as f,resolveAppsDataForFeedPage as m}from"./dataResolvers.js";function b(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function g(r){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){e(r,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}))}return r}var h=function(e){return[l(e,s.well.id),l(e,s.rig.id),l(e,s.frac_fleet.id),l(e,s.pad.id),l(e,"deprecatedAssetId")].join("-")},O={id:null,rig:null,well:null,fracFleet:null,wells:null,isLoading:!1,appHash:null};function j(b){var j=b.apps,y=b.dashboardAssetId,v=j.filter(a),w=u((function(){return function(r){return r.reduce((function(r,t){return g(g({},r),{},e({},t.id,g(g({},O),{},{id:t.id,isLoading:!0,appHash:h(t)})))}),{})}(v)})),P=i(w,2),S=P[0],x=P[1],I=[],F=[],k=[],A=[],D=[],H=[],L=[],T=[];v.forEach((function(e){if(!r(e,["app","ui_settings","multi_rig"])){var t=l(e,s.well.id),n=l(e,s.rig.id),i=l(e,s.frac_fleet.id),a=l(e,s.pad.id),o=l(e,"deprecatedAssetId"),p=e.id;H.push([p]),t?I.push([p,t]):n?F.push([p,n]):o?L.push([p,o]):i?(k.push([p,i]),a?D.push([p,a]):A.push([p,i])):y&&T.push([p])}}));var _=!!y,E=!y&&L.length,R=function(r){return v.reduce((function(t,n){var i=n.id,s=r[i],a=h(n);return s&&a===s.appHash?g(g({},t),{},e({},i,s)):g(g({},t),{},e({},i,g(g({},O),{},{id:i,isLoading:!0,appHash:a})))}),{})};return c(p(o.mark((function e(){var r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},x(R),!E){e.next=8;break}return e.next=5,m(L,I,F);case 5:r=e.sent,e.next=18;break;case 8:return e.next=10,f({appsWellIds:I,appsRigIds:F,appsFracFleetIds:k,apps:v,appsPadIds:D,appsFracFleetToFetchWellsIds:A});case 10:if(r=e.sent,!_){e.next=18;break}return e.t0=n,e.t1=r,e.next=16,d(y,T);case 16:e.t2=e.sent,r=(0,e.t0)(e.t1,e.t2);case 18:x((function(e){return t(e,(function(e){var t=r[e.id]||{};return g(g(g({},e),t),{},{isLoading:!1})}))}));case 19:case"end":return e.stop()}}),e)}))),[String(I),String(F),String(k),String(A),String(D),String(H),String(T),y]),S}export default j;
