import e from"@babel/runtime/helpers/defineProperty";import r from"@babel/runtime/helpers/toConsumableArray";import t from"moment";import{isEqual as n,clone as i,get as l}from"lodash";import{getUnitDisplay as o,convertValue as a}from"../../../../utils/index.js";import{jsx as s,Fragment as c,jsxs as u}from"react/jsx-runtime";import{withStyles as d,Checkbox as f,Typography as m,IconButton as p}from"@material-ui/core";import{memo as h,useMemo as b}from"react";import g from"prop-types";import y from"classnames";import v from"@material-ui/icons/Sort";import{AutoSizer as w,Table as x,Column as C}from"react-virtualized";import{METRICS_LIST as k,TABLE_COLUMNS as O,SETTINGS_COLUMN as W,METRICS_KEYS as N}from"../../constants.js";import R from"@material-ui/icons/NotInterested";import{SizeMe as j}from"react-sizeme";import _ from"./SubjectIndicator.js";import D from"./MetricsAddMenu.js";import I from"./MetricsSelect.js";function S(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function T(r){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){e(r,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}))}return r}var q=48,z=44;function A(e,r){var n,i=l(e,r);switch(r){case"distance":n=Number.isFinite(i)?parseFloat(i).toFixed(2):"N/A";break;case"rigReleaseDate":n=Number.isFinite(i)?t.unix(i).format("MM/DD/YYYY"):"N/A";break;default:n=i||""}return n}function M(t){var d=t.subjectWell,h=t.wells,g=t.offsetWells,j=t.metricsKeys,S=t.isMetricsLoading,q=t.sortInfo,z=t.unusableWellAlarm,M=t.dialogWidth,B=t.classes,L=t.onChangeMetricsKeys,P=t.onAddOffsetWell,K=t.onDeleteOffsetWell,F=t.onAddAllOffsetWells,Y=t.onDeleteAllOffsetWells,E=t.onSorting,H=b((function(){return h.filter((function(e){return e.is_usable}))}),[h]),V=b((function(){var e=H.map((function(e){return e.id})).sort(),r=g.map((function(e){return e.id})).sort();return e.length&&n(e,r)}),[H,g]),G=b((function(){return j.reduce((function(e,r){return e.concat(k.filter((function(e){return e.key===r})))}),[])}),[j]),X=b((function(){return[].concat(r(O),r(G.map((function(e){return T(T({},e),{},{width:240})}))),[W])}),[G]),$=b((function(){if(!M||M<=0)return{};var e={},r=[];return X.filter((function(e){return Number.isFinite(e.width)})).forEach((function(t){e[t.key]=t.width-1,r.push(t.width-1)})),X.filter((function(e){return!Number.isFinite(e.width)})).forEach((function(t){var n=r.reduce((function(e,r){return e+r}),0),i=Math.floor((M-n)/(X.length-r.length)),l=t.minWidth||200,o=i<l?l:i;e[t.key]=o-1,r.push(o-1)})),e}),[M,X]),J=b((function(){return Object.values($).reduce((function(e,r){return e+r}),0)}),[$]),Q=function(e){L(e)},U=function(e){e.target.checked?F():Y()},Z=function(r){return s(p,{"data-not-migrated-muiiconbutton":!0,className:B.sortIconButton,onClick:function(){return function(e){E(e)}(r)},children:r!==q.key?s(R,{className:B.sortIcon}):s(v,{className:y(B.sortIcon,e({},B.ascendingSortIcon,1===q.direction))})})},ee=function(e){var r,t=e.label,n=e.dataKey;if("name"===n)return u("div",{className:B.nameWrapper,children:[s(f,{classes:{checked:B.nameCheckBox,indeterminate:B.nameCheckBox},onClick:U,checked:V,indeterminate:g.length>0&&!V,size:"small"}),s(m,{className:y(B.cell,B.nameCell),children:t}),Z(n)]});if(j.includes(n)){var l=G.find((function(e){return e.key===n})),a=G.findIndex((function(e){return e.key===n}));return u("div",{className:B.metricsColumn,children:[s(I,{items:k,currentValue:n,onChange:(r=a,function(e){var t=i(j);t[r]=e,L(t)})}),s(m,{className:y(B.cell,B.unitCell),children:l.unitType?"(".concat(o(l.unitType,l.to),")"):""}),Z(n)]})}return n===W.key?s("div",{className:B.settingsCell,children:s(D,{metricsKeys:j,onChange:Q})}):u("div",{className:B.nameWrapper,children:[s(m,{className:B.cell,children:t}),Z(n)]})},re=function(r){var t=r.rowData,n=r.dataKey;if("name"===n)return u("div",{className:B.nameWrapper,children:[s(f,{color:"primary",checked:g.findIndex((function(e){return e.id===t.id}))>-1,onChange:function(e){return r=t.id,void(e.target.checked?P(r):K(r));var r},size:"small",disabled:!t.is_usable}),s(m,{className:y(B.tableCellLabel,e({},B.tableCellLabelDisabled,!t.is_usable)),children:A(t,n)}),d&&t.id===d.id&&s(_,{})]});if(n===W.key)return s("div",{className:B.settingsCell,children:!t.is_usable&&s(m,{className:B.errorMsg,children:z})});var i=null;if(j.includes(n)){var o=G.find((function(e){return e.key===n}));i=function(e,r,t){var n=l(e,r.key);if(N.includes(r.key)){if(Number.isFinite(n)||n)return r.unitType?a(n,r.unitType,r.from,r.to):n;if(t)return"loading..."}return""}(t,o,S)}else i=A(t,n);return s(m,{className:y(B.cell,B.tableCellLabel,e({},B.tableCellLabelDisabled,!t.is_usable)),children:i})};return s(c,{children:s("div",{className:B.tableWrapper,children:s(w,{children:function(e){var r=e.height;return s(x,{width:J,height:r,headerHeight:44,rowHeight:48,rowCount:h.length,rowGetter:function(e){var r=e.index;return h[r]},className:B.table,children:X.map((function(e){return s(C,{width:$[e.key]||200,dataKey:e.key,label:e.label,headerRenderer:ee,cellRenderer:re},e.key)}))})}})})})}M.propTypes={subjectWell:g.shape({id:g.number}),wells:g.arrayOf(g.shape({})).isRequired,offsetWells:g.arrayOf(g.shape({})).isRequired,metricsKeys:g.arrayOf(g.string).isRequired,isMetricsLoading:g.bool.isRequired,sortInfo:g.shape({key:g.string.isRequired,direction:g.number.isRequired}).isRequired,classes:g.shape({}).isRequired,onChangeMetricsKeys:g.func.isRequired,onAddOffsetWell:g.func.isRequired,onDeleteOffsetWell:g.func.isRequired,onAddAllOffsetWells:g.func.isRequired,onDeleteAllOffsetWells:g.func.isRequired,onSorting:g.func.isRequired,unusableWellAlarm:g.string.isRequired,dialogWidth:g.number},M.defaultProps={subjectWell:null,dialogWidth:0};var B=d((function(e){return{title:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",marginBottom:"15px",marginTop:"16px"},tableWrapper:{marginTop:"20px",overflowX:"auto",overflowY:"hidden",position:"relative",height:2e3,minHeight:150,borderTop:"1px solid rgba(81, 81, 81, 1)"},table:{"& .ReactVirtualized__Table__headerRow":{textTransform:"none",borderBottom:e.isLightTheme?"1px solid rgba(224, 224, 224, 1)":"1px solid rgba(81, 81, 81, 1)"},"& .ReactVirtualized__Table__row":{borderBottom:e.isLightTheme?"1px solid rgba(224, 224, 224, 1)":"1px solid rgba(81, 81, 81, 1)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},"& .ReactVirtualized__Table__Grid":{outline:"none"},"& .ReactVirtualized__Table__headerColumn":{outline:"none"}},cell:{color:"rgba(255, 255, 255, 0.54)",padding:"5px 10px",fontSize:"12px",whiteSpace:"nowrap"},nameWrapper:{display:"flex",alignItems:"center"},nameCell:{padding:0},unitCell:{padding:0},tableRowHoverEnabled:{"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},settingsCell:{textAlign:"right"},rigReleaseCell:{whiteSpace:"nowrap"},nameCheckBox:{color:e.palette.primary.main},bodyCell:{fontSize:"0.90rem",padding:"5px 10px"},metricsCellWrapper:{display:"flex",flexDirection:"row",alignContent:"center"},tableTitle:{fontSize:"16px",lineHeight:"140.6%",marginTop:10},tableTitleItems:{display:"flex",flexDirection:"row",alignItems:"center"},addWellInput:{width:300,marginTop:10},sortIconButton:{padding:"8px","&:hover $sortIcon":{color:"#fff"}},ascendingSortIcon:{transform:"scaleY(-1)"},sortIcon:{fontSize:"14px",color:"#BDBDBD"},metricsColumn:{display:"flex",alignItems:"center"},tableCellLabel:{fontSize:"0.90rem",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",color:"#fff"},tableCellLabelDisabled:{color:"#C4C4C4"},errorMsg:{color:"#C4C4C4",fontStyle:"italic",fontSize:"14px",padding:"0 16px",whiteSpace:"nowrap"}}}))(h((function(e){return s(j,{monitorWidth:!0,children:function(r){var t=r.size;return s(M,T({dialogWidth:t.width},e))}})})));export default B;export{z as HEADER_HEIGHT,q as ROW_HEIGHT};
