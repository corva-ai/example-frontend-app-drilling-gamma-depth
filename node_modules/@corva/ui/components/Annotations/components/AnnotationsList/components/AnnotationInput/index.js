import t from"moment";import e from"@babel/runtime/helpers/slicedToArray";import n from"@material-ui/core/colors/grey";import{jsxs as i,jsx as o}from"react/jsx-runtime";import{Paper as a,Input as l,Tooltip as r,FormControl as c,InputLabel as s,MenuItem as m,Typography as d,IconButton as p}from"@material-ui/core";import{useState as u}from"react";import f from"../../../../../../effects/useEscPress.js";import{string as h,shape as g,func as v,bool as b,number as y}from"prop-types";import{withStyles as A}from"@material-ui/core/styles";import{ANNOTATION_ACTIVE_PERIODS as N}from"../../../../constants.js";import j from"@material-ui/icons/Send";import{isSuggestionsListOpened as C}from"../../../../../UserMention/utils/index.js";import I from"../../../../../UserMention/index.js";import U from"../../../../../EmojiIconButton.js";import S from"../../../../../FailedFileUploading.js";import E from"../../../../../FileUploadIconButton.js";import x from"../../../../../FilePreview/index.js";import _ from"./StyledSelect.js";import P from"./style.css.js";var k="AppAnnotationsPo",B=Object.keys(N),F=function(h){var g=h.initialText,v=h.initialPeriod,b=h.onSend,y=h.onClose,A=h.closeOnEsc,F=h.classes,T=h.initialAttachment,w=h.assetCompanyId,R=h.currentUser,L=u(g),D=e(L,2),O=D[0],z=D[1],H=u((function(){return T?{attachmentName:T.file_name,attachmentUrl:T.s3_link}:null})),M=e(H,2),W=M[0],q=M[1],K=u(null),G=e(K,2),J=G[0],Q=G[1],V=u(!1),X=e(V,2),Y=X[0],Z=X[1],$=u(B[0]),tt=e($,2),et=tt[0],nt=tt[1];f((function(){A&&y()}));var it=function(){if(O){var e=function(e,n){if("forever"===e)return null;var i=N[e];return t(n).add(i.time.amount,i.time.key).format()}(et,v);b(O,e,W)}};return i("div",{className:P.cAnnotationInput,children:[i(a,{className:P.cAnnotationInputContent,children:[o(l,{"data-testid":"".concat(k,"_annotationsInput"),inputComponent:I,inputProps:{withLightTheme:!1,onChange:function(t){return z(t)},onKeyDown:function(t){"Shift"===t.key&&Z(!0),"Enter"!==t.key||Y||C()||(t.preventDefault(),it())},onKeyUp:function(t){"Shift"===t.key&&Z(!1)},companyId:w,currentUser:R},placeholder:"Type annotation here",fullWidth:!0,disableUnderline:!0,multiline:!0,rows:"3",className:F.inputRoot,value:O}),i("div",{className:P.cAnnotationInputContentActions,children:[o(r,{title:"Attach File",placement:"bottom",children:o("div",{className:P.cAnnotationInputContentActionsButton,children:o(E,{"data-testid":"".concat(k,"_attachFileButton"),openPreviewDialogOnUpload:!1,disableRipple:!0,onFinish:function(t,e,n){q({attachmentUrl:t,attachmentName:e,attachmentSize:n}),Q(null)},onError:function(t){q(null),Q(t)},htmlColor:"action"})})}),o(r,{title:"Add Emoji",placement:"bottom",children:o("div",{className:P.cAnnotationInputContentActionsButton,children:o(U,{"data-testid":"".concat(k,"_emojiButton"),htmlColor:n[400],handleSelectEmoji:function(t){return z("".concat(O).concat(t.native))}})})})]})]}),J&&o(S,{className:F.uploadingError,errorMessage:J}),W&&W.attachmentUrl&&o(x,{fileName:W.attachmentName,fileUrl:W.attachmentUrl,handleFileDelete:function(){q(null),Q(null)}}),i("div",{className:P.cAnnotationInputActions,children:[i(c,{className:F.formControl,children:[o(s,{shrink:!0,id:"periods-label-label",className:F.selectLabel,children:"Active"}),o(_,{"data-testid":"".concat(k,"_periodDropdown"),labelId:"periods-label-label",id:"periods-label",value:et,disableUnderline:!0,onChange:function(t){return nt(t.target.value)},children:B.map((function(t){return o(m,{"data-testid":"".concat(k,"_period_").concat(N[t].label,"MenuItem"),value:t,children:N[t].label},t)}))})]}),i("div",{className:P.cAnnotationInputActionsSend,children:[i(d,{variant:"caption",className:F.sendLabel,children:["Press ",o(d,{variant:"caption",color:"primary",component:"span",className:F.labelHighlighter,children:"Enter "}),"to send "]}),o(r,{title:"Send",placement:"bottom",children:o("div",{children:o(p,{"data-testid":"".concat(k,"_sendButton"),className:F.sendButton,onClick:it,disabled:!O,children:o(j,{color:"primary"})})})})]})]})]})};F.propTypes={initialText:h,initialPeriod:h,initialAttachment:g({file_name:h,s3_link:h}),onSend:v,onClose:v,closeOnEsc:b,assetCompanyId:y.isRequired,currentUser:g().isRequired,classes:g().isRequired},F.defaultProps={initialText:"",initialPeriod:void 0,initialAttachment:null,onSend:function(){},onClose:function(){},closeOnEsc:!1};var T=A((function(t){return{inputLabel:{color:t.palette.grey[700],fontWeight:200,width:"100%"},inputRoot:{lineHeight:15},sendLabel:{display:"flex",alignItems:"center",fontWeight:200,color:t.palette.grey[700],marginRight:22,fontSize:10},sendButton:{padding:5},labelHighlighter:{fontWeight:200,fontSize:10},selectLabel:{fontSize:10,lineHeight:"14px",color:t.palette.grey[500]},uploadingError:{paddingTop:"10px"}}}))(F);export default T;
