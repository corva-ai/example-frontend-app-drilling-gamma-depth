import e from"@babel/runtime/helpers/defineProperty";import r from"@babel/runtime/helpers/toConsumableArray";import t from"moment";import{get as o,set as i}from"lodash";import n from"@babel/runtime/helpers/classCallCheck";import s from"@babel/runtime/regenerator";import a from"@babel/runtime/helpers/asyncToGenerator";import d from"@material-ui/core/colors/grey";import l from"@babel/runtime/helpers/createClass";import{jsx as u,jsxs as p}from"react/jsx-runtime";import{PureComponent as c}from"react";import h from"prop-types";import m from"classnames";import f from"@babel/runtime/helpers/assertThisInitialized";import y from"@babel/runtime/helpers/inherits";import b from"@babel/runtime/helpers/possibleConstructorReturn";import I from"@babel/runtime/helpers/getPrototypeOf";import g from"react-infinite-scroller";import v from"../LoadingIndicator/LoadingIndicator.js";import L from"./styles.css.js";function T(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,o=I(e);if(r){var i=I(this).constructor;t=Reflect.construct(o,arguments,i)}else t=o.apply(this,arguments);return b(this,t)}}var D=d[700],C={newerThan12Hours:"Last 12 hours",olderThan12Hours:"Last 24 hours",olderThan1Days:"Earlier this week",olderThan7Days:"Older than 7 days",olderThan14Days:"Older than 14 days",olderThan30Days:"Older than 30 days"},w=function(d){y(b,c);var h=T(b);function b(r){var t;return n(this,b),t=h.call(this,r),e(f(t),"loadItems",a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.isLoadingByScroll){e.next=2;break}return e.abrupt("return");case 2:return t.setState({isLoadingByScroll:!0}),e.next=5,t.props.loadItems();case 5:t.setState({isLoadingByScroll:!1});case 6:case"end":return e.stop()}}),e)})))),t.state={isLoadingByScroll:!1,periodDates:t.periodDates},t.updatePeriodsIntervalId=null,t}return l(b,[{key:"componentDidMount",value:function(){var e=this;this.updatePeriodsIntervalId=setInterval((function(){return e.setState({periodDates:e.periodDates})}),216e5)}},{key:"componentWillUnmount",value:function(){this.updatePeriodsIntervalId&&clearInterval(this.updatePeriodsIntervalId)}},{key:"renderNoItemsLabel",value:function(){return u("div",{"data-testid":"".concat("generic_infiniteList","_noItems"),className:L.cInfiniteListEmpty,children:this.props.noItemsFoundLabel},"c-infinite-list__empty")}},{key:"renderPeriodSeparator",value:function(e){return u("div",{"data-testid":"".concat("generic_infiniteList","_periodLabel"),className:L.cInfiniteListPeriod,style:{color:D},children:C[e]},e)}},{key:"renderItems",value:function(){var e=this;if(!this.props.divideByPeriods)return this.props.items.map((function(r){return e.props.renderItem(r)})).unshift(this.props.headerComponent);var n=this.state.periodDates,s=n.hoursAgo12,a=n.daysAgo1,d=n.daysAgo7,l=n.daysAgo14,u=n.daysAgo30,p=this.props.items.reduce((function(r,n,p){var c,h=e.props.renderItem(n,p),m=o(n,e.props.pathToCreatedAt),f=t(m);return f>=s?c="newerThan12Hours":f<s&&f>=a?c="olderThan12Hours":f<a&&f>=d?c="olderThan1Days":f<d&&f>=l?c="olderThan7Days":f<l&&f>=u?c="olderThan14Days":f<u&&(c="olderThan30Days"),i(r,[c,r[c].length],h)}),{newerThan12Hours:[],olderThan12Hours:[],olderThan1Days:[],olderThan7Days:[],olderThan14Days:[],olderThan30Days:[]}),c=Object.keys(p).reduce((function(t,o){return 0===p[o].length?t.concat(p[o]):t.concat([e.renderPeriodSeparator(o)].concat(r(p[o])))}),[]);return[this.props.headerComponent].concat(r(c))}},{key:"render",value:function(){return p("div",{className:m(L.cInfiniteList,this.props.infiniteClassName,e({},L.cInfiniteListOverflow,!this.props.useWindow)),style:{height:this.props.infiniteContainerHeight},children:[u(g,{loadMore:this.loadItems,hasMore:this.props.moreItemsMayExist&&!this.props.showNoItemsFound,threshold:this.props.threshold,loader:u(v,{fullscreen:!1},"c-infinite-scroll__loader"),useWindow:this.props.useWindow,initialLoad:this.props.initialLoad,children:this.renderItems()}),this.props.showNoItemsFound&&this.renderNoItemsLabel()]})}},{key:"periodDates",get:function(){return{hoursAgo12:t().subtract(12,"hours"),daysAgo1:t().subtract(1,"days"),daysAgo7:t().subtract(7,"days"),daysAgo14:t().subtract(14,"days"),daysAgo30:t().subtract(30,"days")}}}]),b}();w.propTypes={infiniteClassName:h.string,useWindow:h.bool,headerComponent:h.node,items:h.arrayOf(h.shape()).isRequired,showNoItemsFound:h.bool.isRequired,noItemsFoundLabel:h.string.isRequired,infiniteContainerHeight:h.number,moreItemsMayExist:h.bool.isRequired,pathToCreatedAt:h.arrayOf(h.string).isRequired,renderItem:h.func.isRequired,loadItems:h.func.isRequired,threshold:h.number,initialLoad:h.bool,divideByPeriods:h.bool},w.defaultProps={infiniteClassName:null,useWindow:!1,headerComponent:null,infiniteContainerHeight:null,threshold:3e3,initialLoad:!0,divideByPeriods:!0};export default w;
