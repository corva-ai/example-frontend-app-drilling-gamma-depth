import t from"@babel/runtime/helpers/typeof";function e(e){var i=e.getOptions(),r=e.defined,o=e.each,a=e.find,s=e.pick,n=e.extendClass,l=e.merge,p=e.seriesTypes,h=e.wrap,u=(e.perspective,1e-4),c=0;i.plotOptions.contour=l(i.plotOptions.scatter,{marker:{radius:0,fillColor:"#ffffff",states:{hover:{radius:i.plotOptions.scatter.marker.radius}}},states:{hover:{halo:{size:i.plotOptions.scatter.marker.radius+4,attributes:{fill:"#000000"},opacity:.5}}},turboThreshold:0}),p.contour=n(p.heatmap,{type:"contour",hasPointSpecificOptions:!0,getSymbol:p.scatter.prototype.getSymbol,drawPoints:e.Series.prototype.drawPoints,pointClass:e.Point,pointAttribs:e.Series.prototype.pointAttribs,init:function(t){this.is3d=t.is3d&&t.is3d(),this.gradiend_ids={},this.dataFuncState={},p.scatter.prototype.init.apply(this,arguments)},translate:function(){p.scatter.prototype.translate.call(this,arguments),this.translateColors()},dataFunction:function(i){var r=this.options.dataFunction(i);if("number"==typeof r){var a={};return o(this.parallelArrays,(function(t){a[t]="value"===t?r:s(i[t],r)})),a}return"object"===t(r)?e.merge(i,r):null},updateDataIfNecessary:function(){var t=this,i=s(t.options.axis1,"x"),o=s(t.options.axis2,t.is3d?"z":"y"),a=t[i+"Axis"],n=t[o+"Axis"];if(t.options.dataFunction&&r(a.min)&&r(a.max)&&r(n.min)&&r(n.max)){var l=s(a.min,a.options.min),h=s(n.min,n.options.min),u=s(a.max,a.options.max),c=s(n.max,n.options.max),d=s(t.options.grid_width,t.options.grid_height,21),x=s(t.options.grid_height,t.options.grid_width,21),f={dataFunc:t.options.dataFunction,axis1_type:i,axis2_type:o,axis1_min:l,axis1_max:u,axis2_min:h,axis2_max:c,axis1_steps:d,axis2_steps:x},g=e.cleanRecursively(f,t.dataFuncState);if(0!==Object.keys(g).length){t.dataFuncState=f;for(var v=[],m=0;m<x;m++)for(var y=0;y<d;y++){var _={};_[i]=y/(d-1)*(u-l)+l,_[o]=m/(x-1)*(c-h)+h;var A=this.dataFunction(_);v.push(A)}return p.scatter.prototype.setData.call(this,v,!0,!1,!1)}}},bindAxes:function(){this.is3d?(this.axisTypes=["xAxis","yAxis","zAxis","colorAxis"],this.parallelArrays=["x","y","z","value"]):(this.axisTypes=["xAxis","yAxis","colorAxis"],this.parallelArrays=["x","y","value"]),p.scatter.prototype.bindAxes.apply(this,arguments)},drawTriangle:function(t,i,r,o,a,s){var n,l=this,p=this.chart,h=this.chart.renderer,v=t.A,m=t.B,y=t.C,_=[v,m,y];if(r){var A=[this.colorAxis.normalizedValue(v.value),this.colorAxis.normalizedValue(m.value),this.colorAxis.normalizedValue(y.value)],b=Math.max(A[0],A[1],A[2]),w=Math.min(A[0],A[1],A[2]),Y=Math.abs(d(v,m,y));if(b-w<u||Y<u)n=this.colorAxis.toColor((v.value+m.value+y.value)/3);else{var X=new g([[v.plotX,v.plotY,1,A[0]],[m.plotX,m.plotY,1,A[1]],[y.plotX,y.plotY,1,A[2]]]);X.toReducedRowEchelonForm();var k=X.mtx[0][3],z=X.mtx[1][3],S=X.mtx[2][3],M=(0-S)/(k*k+z*z),F=(1-S)/(k*k+z*z),T=x(M*k),C=x(M*z),O=x(F*k),P=x(F*z);if(h.isSVG){var V=t.gradient;V?V.animate({x1:T,y1:C,x2:O,y2:P}):(V=h.createElement("linearGradient"),t.gradient=V,V.add(h.defs),V.attr({id:"contour-gradient-id-"+c++,x1:T,y1:C,x2:O,y2:P})),V.element.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.base_gradient_id),n="url("+h.url+"#"+V.attr("id")+")"}else n={linearGradient:{x1:T,y1:C,x2:O,y2:P,spreadMethod:"pad",gradientUnits:"userSpaceOnUse"},stops:this.colorAxis.stops}}var E=["M",v.plotX,v.plotY,"L",m.plotX,m.plotY,"L",y.plotX,y.plotY,"Z"];t.shape?(t.shape.animate({d:E}).attr({fill:n}),t.shape.parent!=t.group&&t.shape.add(t.group)):(t.shape=h.path(E).attr({"shape-rendering":"crispEdges",fill:n}),t.shape.on("mousemove",(function(i){if(i=p.pointer.normalize(i),p.inverted)var r=p.plotTop+p.plotHeight-i.chartY,o=p.plotLeft+p.plotWidth-i.chartX;else r=i.chartX-p.plotLeft,o=i.chartY-p.plotTop;if(l.options.interpolateTooltip){var a=new g([[v.plotX,v.plotY,1,v.x,v.y,v.z,v.value],[m.plotX,m.plotY,1,m.x,m.y,m.z,m.value],[y.plotX,y.plotY,1,y.x,y.y,y.z,y.value]]);a.toReducedRowEchelonForm();var s={x:f(l.xAxis,a.mtx[0][3]*r+a.mtx[1][3]*o+a.mtx[2][3]),y:f(l.yAxis,a.mtx[0][4]*r+a.mtx[1][4]*o+a.mtx[2][4]),z:f(l.zAxis,a.mtx[0][5]*r+a.mtx[1][5]*o+a.mtx[2][5]),value:a.mtx[0][6]*r+a.mtx[1][6]*o+a.mtx[2][6]};l.options.dataFunction&&(s=l.dataFunction(s));var n=(new e.Point).init(l);n.applyOptions(s);var h=l.data;l.data=[n],l.translate(),l.data=h,p.tooltip.refresh(n,i)}else{var u=function(t){return(t.plotX-r)*(t.plotX-r)+(t.plotY-o)*(t.plotY-o)},c=t.A;u(t.B)<u(c)&&(c=t.B),u(t.C)<u(c)&&(c=t.C),c.onMouseOver(i)}})),t.shape.add(t.group))}else t.shape&&(t.shape.destroy,delete t.shape);var L=t.group.edge_path,j=t.group.edge_path_old;if(o||a){var G=function(t,e,r,o){i[e+"-"+t]?a&&i[t+"-"+e]--:1==i[t+"-"+e]--&&(L.push("M",r.plotX,r.plotY,"L",o.plotX,o.plotY),j.push("M",r.plotX_prev,r.plotY_prev,"L",o.plotX_prev,o.plotY_prev))};G(t.a,t.b,t.A,t.B),G(t.b,t.c,t.B,t.C),G(t.c,t.a,t.C,t.A)}for(var R=0;R<s.length;R++){var B=s[R].axis,Z=s[R].attr;for(var I in B.tickPositions){for(var D=B.tickPositions[I],U=[],N=0;N<3;N++){T=_[N].plotX;var W=_[N].plotX_prev,H=(C=_[N].plotY,_[N].plotY_prev),q=_[N][Z],J=(O=_[(N+1)%3].plotX,_[(N+1)%3].plotX_prev),K=(P=_[(N+1)%3].plotY,_[(N+1)%3].plotY_prev),Q=_[(N+1)%3][Z];if(q!=Q&&D>=Math.min(q,Q)&&D<Math.max(q,Q)){var $=(D-q)/(Q-q);U.push([$*(O-T)+T,$*(P-C)+C,$*(J-W)+W,$*(K-H)+H])}}2==U.length&&(L.push("M",U[0][0],U[0][1],"L",U[1][0],U[1][1]),j.push("M",U[0][2],U[0][3],"L",U[1][2],U[1][3]))}}},assignGroups:function(){for(var t=this,i=0;i<t.triangles.length;i++)t.triangles[i].group_id=t.is3d?i:0;var r={},o=t.groups;for(i=0;i<t.triangles.length;i++){var a=t.triangles[i],s=a.group_id;o[s]?(r[s]=o[s],r[s].zSum=0,r[s].triangle_count=0,delete o[s]):r[s]||(r[s]=t.chart.renderer.g().add(this.surface_group),r[s].zSum=0,r[s].triangle_count=0),t.triangles[i].group=r[s],r[s].zSum+=a.A.plotZ+a.B.plotZ+a.C.plotZ,r[s].triangle_count++}e.objectEach(r,(function(t,e){t.attr({zIndex:-t.zSum/(3*t.triangle_count)})})),e.objectEach(o,(function(t){t.destroy()})),t.groups=r},drawGraph:function(){this.updateDataIfNecessary();var i=this,r=i.points,o=this.options,a=i.chart.renderer;if(i.surface_group||(i.surface_group=a.g().add(i.group),i.triangles=[],i.groups={}),i.chart.renderer.isSVG){for(var n="",l=0;l<this.colorAxis.stops.length;l++)for(var p=0;p<this.colorAxis.stops[l].length;p++)n+=":"+this.colorAxis.stops[l][p];if(!this.gradiend_ids[n]){var h=i.chart.renderer.rect(0,0,1,1).attr({fill:{linearGradient:{x1:0,y1:0,x2:1,y2:0,spreadMethod:"pad",gradientUnits:"userSpaceOnUse"},stops:this.colorAxis.stops}});this.gradiend_ids[n]=/(#.*)[)]/.exec(h.attr("fill"))[1]}this.base_gradient_id=this.gradiend_ids[n]}i.surface_group;var u=0,c={},x=function(t){return t&&"number"==typeof t.x&&"number"==typeof t.y&&("number"==typeof t.z||!i.is3d)&&"number"==typeof t.value},f=function(t,e){c[t+"-"+e]=(c[t+"-"+e]||0)+1},g=function(t,e,o){if(x(r[t])&&x(r[e])&&x(r[o])){if(i.is3d)if(d(r[t],r[e],r[o])<0){var a=t;t=e,e=a}var s=i.triangles[u];s||(s=i.triangles[u]={}),u++,s.a=t,s.b=e,s.c=o,s.A=r[t],s.B=r[e],s.C=r[o],f(t,e),f(e,o),f(o,t)}},v=[];if(o.triangles)for(l=0;l<o.triangles.length;l++){var m=o.triangles[l];"number"==typeof m?v.push(m):"object"===t(m)&&"number"==typeof m[0]&&"number"==typeof m[1]&&"number"==typeof m[2]&&v.push(m[0],m[1],m[2])}else if(o.grid_width){var y=o.grid_width;for(l=1;l<r.length/y;l++)for(p=1;p<o.grid_width&&l*y+p<r.length;p++){var _=(l-1)*y+(p-1),A=(l-1)*y+p,b=l*y+(p-1),w=l*y+p;this.is3d&&Math.abs(r[_].value-r[w].value)<Math.abs(r[A].value-r[b].value)?(v.push(_,A,w),v.push(_,w,b)):(v.push(_,A,b),v.push(A,w,b))}}else r=r.filter(x),v=Delaunay.triangulate(r.map(this.is3d?function(t){return[t.axisXpos,t.axisZpos]}:function(t){return[t.plotX,t.plotY]}));for(l=0;l<v.length-2;l+=3)g(v[l],v[l+1],v[l+2]);for(l=u;l<i.triangles.length;l++)i.triangles[l].shape&&i.triangles[l].shape.destroy(),i.triangles[l].edge&&i.triangles[l].edge.destroy(),i.triangles[l].gradient&&i.triangles[l].gradient.destroy();i.triangles.splice(u,i.triangles.length-u),this.assignGroups(),e.objectEach(i.groups,(function(t){t.edge_path_old=[],t.edge_path=[]}));var Y=[];for(o.contours?e.each(o.contours,(function(t){switch(t){case"x":Y.push({axis:i.xAxis,attr:"x"});break;case"y":Y.push({axis:i.yAxis,attr:"y"});break;case"z":Y.push({axis:i.zAxis,attr:"z"});break;case"value":Y.push({axis:i.colorAxis,attr:"value"})}})):o.showContours&&Y.push({axis:i.colorAxis,attr:"value"}),l=0;l<u;l++)i.drawTriangle(i.triangles[l],c,s(o.showFaces,!0),s(o.showEdges,!1),s(o.showTriangles,!1),Y);e.objectEach(i.groups,(function(t){t.edge_path.length?t.edges?t.edges.attr({d:t.edge_path_old}).animate({d:t.edge_path}):(t.edges=a.path(t.edge_path).attr({"stroke-linecap":"round",stroke:"black","stroke-width":1,zIndex:1}),t.edges.add(t)):t.edges&&(t.edges.destroy(),delete t.edges)})),e.each(r,(function(t){t.plotX_prev=t.plotX,t.plotY_prev=t.plotY,t.plotZ_prev=t.plotZ}))}});var d=function(t,e,i){return(t.plotX*(e.plotY-i.plotY)+e.plotX*(i.plotY-t.plotY)+i.plotX*(t.plotY-e.plotY))/2},x=function(t){return t>=-1e-6&&t<=1e-6?0:t},f=function(t,i){if(!t)return i;var r=t.toValue(t.toPixels(i)-.5),o=t.toValue(t.toPixels(i)+.5),a=Math.abs(o-r),s=e.normalizeTickInterval(a,[1,2,5,10],e.getMagnitude(a),!0);return e.correctFloat(s*Math.round(i/s))};function g(t){this.mtx=t,this.height=t.length,this.width=t[0].length}g.prototype.toReducedRowEchelonForm=function(){for(var t=0;t<this.width&&t<this.height;t++){for(var e=null,i=0,r=t;r<this.height;r++)Math.abs(this.mtx[r][t])>i&&(e=r,i=Math.abs(this.mtx[r][t]));if(null!=e){var o=this.mtx[t];this.mtx[t]=this.mtx[e],this.mtx[e]=o;for(r=0;r<this.height;r++)if(r!=t)for(var a=this.mtx[r][t]/this.mtx[t][t],s=t;s<this.width;s++)this.mtx[r][s]-=a*this.mtx[t][s];for(a=this.mtx[t][t],s=t;s<this.width;s++)this.mtx[t][s]/=a;for(r=0;r<this.height;r++)this.mtx[r][t]=r==t?1:0}else for(var r=0;r<this.height;r++)this.mtx[r][t]=0}return this},g.prototype.toString=function(){for(var t=[],e=0;e<this.mtx.length;e++)t.push(this.mtx[e].join(","));return t.join("\n")};var v=function(t,e){var i,r,o=t.contourSeries.xAxis,a=t.contourSeries.yAxis;return t.isXAxis?(i=o.toValue(e,!0),r=a.toValue(!t.opposite!=!t.chart.inverted?0:a.len,!0)):(i=o.toValue(!t.opposite!=!t.chart.inverted?o.len:0,!0),r=a.toValue(e,!0)),{x:i,y:r}},m=function(){var t=this,i=t.contourSeries;if(!i){if(!(i=a(t.chart.series,(function(e){return t.options.serie?e.id===t.options.serie||e.options&&e.options.id===t.options.serie:"contour"===e.type}))))return e.error(17,!1),[];t.contourSeries=i,o(i.axisTypes||[],(function(e){h(i[e],"setTickPositions",(function(e){e.apply(this,[].slice.call(arguments,1)),t.forceRedraw=!0,t.setScale()}))}))}var r,s,n=i.colorAxis.tickPositions;if(!n||0===n.length)return[];for(var l=[],p={},u=0;u<=t.len;u++){var c=t.toValue(u,!0),d=i.dataFunction(v(t,u)).value;if(u>0&&s!==d)for(var x in n){var f=n[x];if(f>=Math.min(s,d)&&f<=Math.max(s,d)){var g=(f-s)/(d-s)*(c-r)+r;l.push(g),p[g]=f}}r=c,s=d}return t._contourAxisLabels=p,l};h(e.Axis.prototype,"setOptions",(function(t,e){return e.contourAxis&&(e=l({tickWidth:1,tickColor:"black",title:{text:null}},e,{min:0,max:1,startOnTick:!1,endOnTick:!1,tickPositioner:m})),t.call(this,e)})),h(e.Axis.prototype,"init",(function(t,e,i){if(t.apply(this,[].slice.call(arguments,1)),this.options.tickPositioner===m){var r=this.labelFormatter;this.labelFormatter=function(){return this.value=this.axis._contourAxisLabels[this.value],r.call(this)}}}))}export default e;
