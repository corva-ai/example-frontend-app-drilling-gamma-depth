import e from"@babel/runtime/helpers/defineProperty";import{get as n,orderBy as t,uniq as l}from"lodash";import i from"@babel/runtime/helpers/slicedToArray";import{jsxs as o,jsx as r,Fragment as c}from"react/jsx-runtime";import{makeStyles as s,Dialog as a,DialogTitle as d,Typography as u,Tooltip as f,IconButton as m,DialogContent as p,DialogActions as b,Button as g}from"@material-ui/core";import h from"@material-ui/icons/Close";import{memo as y,useState as S,useEffect as W,useMemo as v,useCallback as j}from"react";import I from"prop-types";import C from"classnames";import{useTheme as O}from"@material-ui/core/styles";import A from"../LoadingIndicator/LoadingIndicator.js";import N from"@material-ui/core/useMediaQuery";import{DEFAULT_SETTINGS as x}from"./constants.js";import D from"./components/Filter/index.js";import w from"./effects/biDirectionalFiltering.js";import{useCompanies as k,useWells as T,useCompanyMetricKey as B,useFilteredWells as P,useWellsWithCoords as R,useRadiusWells as L,useOffsetWells as z,useMetricsData as U}from"./effects/index.js";import q from"./components/Map/index.js";import E from"./components/Table/index.js";function M(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function F(n){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?M(Object(l),!0).forEach((function(t){e(n,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(l)):M(Object(l)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(l,e))}))}return n}var _=s({dialogTitles:{display:"flex",justifyContent:"space-between",alignItems:"center"},title:{fontSize:20},subTitle:{fontSize:14,color:"#03BCD4","&:hover":{cursor:"pointer",textDecoration:"underline"}},subTitleSpace:{fontSize:14,color:"#03BCD4"},titleArea:{display:"flex",alignItems:"center"},closeIconButton:{fontSize:20,padding:4,"&:hover $closeIcon":{color:"#fff"}},closeIcon:{color:"#BDBDBD"},dialogActions:{justifyContent:"space-between",boxShadow:"0px -4px 10px rgba(0, 0, 0, 0.25)",paddingTop:8,paddingBottom:8},dialogActionsSmallScreen:{paddingRight:"100px"},dialogContent:{display:"flex",flexDirection:"column"},tabs:{background:"#414141"},selectedWells:{display:"flex",alignItems:"center"},selected:{fontSize:16},selectedLabel:{fontSize:12,marginLeft:14,color:"rgba(255, 255, 255, 0.54)"},selectedNumber:{fontSize:12,margin:4,color:"rgba(255, 255, 255, 0.8)"}}),K=function(s){var y=s.isOpen,I=s.defaultSubjectWellId,M=s.companyId,K=s.offsetSetting,H=s.currentUser,Q=s.addWellsUsabilityInfo,$=s.unusableWellAlarm,G=s.isAdvancedSearch,J=s.bestCount,V=s.onClose,X=s.onSave,Y=_(),Z=O(),ee=N(Z.breakpoints.down("sm")),ne=("admin"===n(H,"role")||"developeradmin"===n(H,"role"))&&"corva"===n(H,["company","provider"]),te=S(M||n(K,"companyId")||+n(H,"company_id")),le=i(te,2),ie=le[0],oe=le[1],re=S(n(K,"subjectWellId")||I),ce=i(re,2),se=ce[0],ae=ce[1],de=S(n(K,"filters")||x.filters),ue=i(de,2),fe=ue[0],me=ue[1],pe=S(n(K,"radius")||x.radius),be=i(pe,2),ge=be[0],he=be[1],ye=S([]),Se=i(ye,2),We=Se[0],ve=Se[1],je=S(x.sortInfo),Ie=i(je,2),Ce=Ie[0],Oe=Ie[1],Ae=S(!1),Ne=i(Ae,2),xe=Ne[0],De=Ne[1],we=S([]),ke=i(we,2),Te=ke[0],Be=ke[1];W((function(){y&&(Be(n(K,"selectedWellIds")||[]),oe(M||n(K,"companyId")||+n(H,"company_id")),ae(n(K,"subjectWellId")||I))}),[y,K]);var Pe=v((function(){return!!se}),[se]),Re=k(ne,G&&I,ie),Le=T(ie,Q),ze=B(ie);W((function(){ve((function(e){return ze?[ze]:e}))}),[ze]);var Ue=w(fe,Le),qe=P(fe,Le),Ee=v((function(){return qe&&se?qe.find((function(e){return e.id===se})):null}),[qe,se]),Me=R(qe,Ee);L(ge,Me,Be);var Fe=z(ge,Le,Te),_e=U(ie,Me),Ke=i(_e,2),He=Ke[0],Qe=Ke[1],$e=v((function(){return Qe?t(Qe,Ce.key,1===Ce.direction?"asc":"desc"):Qe}),[Ce,Qe]),Ge=j((function(e){oe(e),ae(null),Be([]),me(x.filters)}),[]),Je=j((function(e){var n=qe.find((function(n){return n.id===e}));n&&n.is_usable&&Be(l(Te.concat(e)))}),[Te,qe]),Ve=j((function(e){Be(l(Te.filter((function(n){return n!==e}))))}),[Te]),Xe=j((function(){Be(qe.filter((function(e){return e.is_usable})).map((function(e){return e.id})))}),[qe]),Ye=j((function(){Be([])}),[qe]),Ze=j((function(e){Be([]),ae(e)}),[Le]),en=j((function(){Be([]),ae(null)}),[]),nn=j((function(e){he(e)}),[]),tn=j((function(n,t){me((function(l){return F(F({},l),{},e({},n,t))})),Be([])}),[]),ln=j((function(){me(F({},x.filters)),Be([])}),[]),on=j((function(){De((function(e){return!e}))}),[]),rn=j((function(e){ve(e)}),[]),cn=j((function(e){Oe((function(n){return n.key===e?F(F({},n),{},{direction:-1*n.direction}):{key:e,direction:1}}))}),[]),sn=function(){V()},an=!(Le&&qe&&Me&&Qe&&Fe&&$e);return o(a,{onBackdropClick:V,onEscapeKeyDown:V,maxWidth:"lg",fullWidth:!0,fullScreen:ee,open:y,children:[r(d,{children:o("div",{className:Y.dialogTitles,children:[G?o("div",{className:Y.titleArea,children:[r(u,{className:Y.subTitle,onClick:sn,children:"Select Offset Wells"}),r(u,{className:Y.subTitleSpace,children:" / "}),r(u,{className:Y.title,children:"Advanced Search"})]}):r(u,{className:Y.title,children:"Select Offset Wells"}),r(f,{title:"Close",children:r(m,{"data-not-migrated-muiiconbutton":!0,"aria-label":"close",className:Y.closeIconButton,onClick:V,children:r(h,{className:Y.closeIcon})})})]})}),r(p,{className:Y.dialogContent,children:an?r(A,{fullscreen:!1}):o(c,{children:[r(D,{companyId:ie,companies:Re,isCurrentUserCorvaAdmin:ne,radius:ge,wells:qe,subjectWell:Ee,filters:fe,filtersOptions:Ue,mapHidden:xe,isRadiusEditable:Pe,onChangeCompany:Ge,onSetSubjectWell:Ze,onChangeRadius:nn,onChangeFilters:tn,onClearFilters:ln,onToggleMap:on}),r(q,{subjectWell:Ee,wells:qe,offsetWells:Fe,radius:ge,mapHidden:xe,onSetSubjectWell:Ze,onRemoveSubjectWell:en,onAddOffsetWell:Je,onDeleteOffsetWell:Ve}),r(E,{subjectWell:Ee,wells:$e,offsetWells:Fe,metricsKeys:We,sortInfo:Ce,isMetricsLoading:He,unusableWellAlarm:$,onChangeMetricsKeys:rn,onSorting:cn,onAddOffsetWell:Je,onDeleteOffsetWell:Ve,onAddAllOffsetWells:Xe,onDeleteAllOffsetWells:Ye})]})}),o(b,{className:C(Y.dialogActions,e({},Y.dialogActionsSmallScreen,ee)),children:[G?o("div",{className:Y.selectedWells,children:[r(u,{className:Y.selected,children:"Selected:"}),r(u,{className:Y.selectedLabel,children:"Best:"}),r(u,{className:Y.selectedNumber,children:J}),r(u,{className:Y.selectedLabel,children:"Advanced Search:"}),r(u,{className:Y.selectedNumber,children:(null==Fe?void 0:Fe.length)||0})]}):r("div",{}),o("div",{children:[r(g,{onClick:sn,color:"primary",style:{marginRight:16},children:"CANCEL"}),o(g,{variant:"contained",color:"primary",onClick:function(){var e=F(F({},K),{},{companyId:ie,subjectWellId:se,radius:ge,filters:fe,selectedWellIds:l(Fe.map((function(e){return e.id})))});X(e,Fe)},children:["ADD (",(null==Fe?void 0:Fe.length)||0,")"]})]})]})]})};K.propTypes={isOpen:I.bool.isRequired,defaultSubjectWellId:I.number,companyId:I.number,offsetSetting:I.shape({}).isRequired,currentUser:I.shape({}).isRequired,addWellsUsabilityInfo:I.func,unusableWellAlarm:I.string,isAdvancedSearch:I.bool,bestCount:I.number,onSave:I.func.isRequired,onClose:I.func.isRequired},K.defaultProps={defaultSubjectWellId:null,companyId:null,addWellsUsabilityInfo:null,unusableWellAlarm:"Unable to add",isAdvancedSearch:!1,bestCount:0};var H=y(K);export default H;
