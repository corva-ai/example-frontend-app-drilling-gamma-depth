import e from"@babel/runtime/helpers/defineProperty";import{get as t,maxBy as r}from"lodash";import{jsx as s,jsxs as i}from"react/jsx-runtime";import{useRef as n,useEffect as o,useMemo as a}from"react";import p from"uuid";import{shape as m,arrayOf as u,string as c,number as d,func as l,bool as f}from"prop-types";import g from"classnames";import{DEFAULT_TRACK_SETTINGS as y,SETTINGS_KEY as h}from"./constants.js";import j from"./SettingsContext.js";import O from"./DataContext.js";import b from"./ChartsContext.js";import C from"./components/Track.js";import P from"./components/Tooltip/CursorPositioner.js";import{convertData as v}from"./utils/dataParser.js";import x from"./ParameterCharts.css.js";function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function q(t){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?R(Object(s),!0).forEach((function(r){e(t,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):R(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var k=function(m){var u=m.settings,c=m.onSettingsChange,d=m.settingsKey,l=m.horizontal,f=m.mapping,h=m.data,R=m.indexes,k=m.isLoading,w=m.multipleAssets,S=m.assestColors,D=u[d],K=n(new Map);o((function(){D&&D.length||c(q(q({},u),{},e({},d,[q(q({},y),{},{id:p()})])))}),[]);var T=a((function(){return t(r(D,"traces.length"),"traces.length")||1}),[D]),z=a((function(){return w?Object.keys(h).reduce((function(t,r){return q(q({},t),{},e({},r,v({data:h[r],mapping:f,indexesKeys:R.keys})))}),{}):v({data:h,mapping:f,indexesKeys:R.keys})}),[h,f,R.keys,w]);return s(j.Provider,{value:{horizontal:l,settingsKey:d,settings:u,onSettingsChange:c,maxTracesCount:T,multipleAssets:w,assestColors:S},children:s(O.Provider,{value:{mapping:f,parsedData:z,indexes:R,isLoading:k},children:s(b.Provider,{value:{chartsRef:K,onChartChange:function(e,t){K.current.set(e,t)}},children:i("div",{className:g(x.container,e({},x.horizontal,l)),children:[s(P,{}),D&&D.map((function(e,t){return s(C,{settings:u,onSettingsChange:c,id:e.id,index:t},e.id)}))]})})})})};k.propTypes={data:m({}).isRequired,mapping:u(m({name:c.isRequired,key:c.isRequired,unit:c.isRequired,unitType:c.isRequired}).isRequired).isRequired,indexes:m({key:c,name:c,min:d,max:d,unit:c,unitType:c}).isRequired,settingsKey:c,settings:m({}),onSettingsChange:l.isRequired,horizontal:f,multipleAssets:f,isLoading:f.isRequired,assestColors:u(c)},k.defaultProps={settingsKey:h,horizontal:!1,multipleAssets:!1,settings:{},assestColors:[]};export default k;
