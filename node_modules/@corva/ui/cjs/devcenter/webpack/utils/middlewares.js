"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require('../../../../ext-cjs/@babel/runtime/helpers/defineProperty.js'),r=require('../../../../ext-cjs/@babel/runtime/regenerator/index.js'),t=require('../../../../ext-cjs/@babel/runtime/helpers/asyncToGenerator.js'),n=require("./serializeDotEnv.js");function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function s(r){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){e(r,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}))}return r}var c=require("fs").promises,i=require("path"),a=require("express"),u=require("dotenv");exports.onBeforeSetUpMiddleware=function(e,o){var p,l=o.APP_DIRECTORY;e.use(a.json()),e.patch("/dotenv",(p=t(r.mark((function e(t,o){var a,p;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},e.prev=1,e.next=4,c.readFile(i.resolve(l,"./.env"));case 4:p=e.sent,a=u.parse(p),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(1);case 10:return e.prev=10,e.next=13,c.writeFile(i.resolve(l,"./.env"),n(s(s({},a),t.body)));case 13:e.next=19;break;case 15:e.prev=15,e.t1=e.catch(10),console.error("Could not write to .env file"),console.error(e.t1);case 19:o.sendStatus(200);case 20:case"end":return e.stop()}}),e,null,[[1,8],[10,15]])}))),function(e,r){return p.apply(this,arguments)}))};
