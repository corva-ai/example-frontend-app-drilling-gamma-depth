import t from"@babel/runtime/helpers/defineProperty";import{get as e,isEmpty as r}from"lodash";import n from"@babel/runtime/helpers/classCallCheck";import i from"@babel/runtime/helpers/createClass";import{jsx as s,jsxs as o}from"react/jsx-runtime";import{Chip as a,TextField as l,FormControl as c,FormHelperText as p,List as m,ListItem as u,ListItemText as d,withStyles as f}from"@material-ui/core";import{PureComponent as h}from"react";import I from"prop-types";import b from"classnames";import g from"@babel/runtime/helpers/assertThisInitialized";import y from"@babel/runtime/helpers/inherits";import v from"@babel/runtime/helpers/possibleConstructorReturn";import w from"@babel/runtime/helpers/getPrototypeOf";import{Autocomplete as O}from"@material-ui/lab";import"./ChipSelector.css.js";function R(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?R(Object(n),!0).forEach((function(r){t(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=w(t);if(e){var i=w(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return v(this,r)}}var C=new RegExp("^new.*$"),N=function(f){y(v,h);var I=x(v);function v(r){var i;return n(this,v),i=I.call(this,r),t(g(i),"formatItem",(function(t){return{text:i.props.chipFormatter(t),id:e(t,"id"),persistent:e(t,"persistent",!1)}})),t(g(i),"handleChange",(function(t,e){var r=i.formattedSelectedItems,n=new Set(r.map((function(t){return t.id}))),s=new Set(e.map((function(t){return t.id}))),o=e.filter((function(t){return!n.has(t.id)})),a=r.filter((function(t){return!s.has(t.id)&&!t.persistent})).map((function(t){return t.id}));o.forEach(i.handleRequestAdd),a.forEach(i.handleRequestDelete)})),t(g(i),"handleRequestAdd",(function(t){var r=t.id,n=t.text;i.props.allowAddNewItems?i.itemWithSameNameExists(n)?i.setState({isError:!0}):i.props.onAddNew({id:"new".concat(n),name:n}):i.listedItems.find((function(t){return e(t,"id")===r}))?i.props.onAdd(r):i.setState({isError:!0})})),t(g(i),"handleRequestDelete",(function(t){i.props.allowAddNewItems&&C.test(t)?i.props.onRemoveNew(t):i.props.onRemove(t)})),t(g(i),"handleUpdateInput",(function(){i.state.isError&&i.setState({isError:!1})})),t(g(i),"getOptionLabel",(function(t){return t.text})),t(g(i),"renderTags",(function(t,e){return t.map((function(t,r){return s(a,S(S({"data-not-migrated-MuiChip":!0,label:i.getOptionLabel(t)},e({index:r})),{},{onDelete:t.persistent?null:function(){return i.handleRequestDelete(t.id)}}))}))})),t(g(i),"renderInput",(function(t){return s(l,S(S({},t),{},{variant:"standard",placeholder:i.props.hintText}))})),t(g(i),"itemWithSameNameExists",(function(t){return i.props.items.concat(i.props.newItems).map(i.formatItem).find((function(r){return e(r,"text")===t}))})),i.state={isError:!1},i}return i(v,[{key:"componentDidUpdate",value:function(t){var e=t.selectedItems;this.props.selectedItems!==e&&this.setState({isError:!1})}},{key:"render",value:function(){var t=this.state.isError?this.props.errorText:"",e=this.props.classes;return o("div",{children:[o(c,{className:e.formControl,error:!!t,fullWidth:!0,children:[s(O,{"data-testid":"generic_chipInput",multiple:!0,fullWidth:!0,id:"chip-selector",classes:{inputRoot:e.inputRoot},value:this.formattedSelectedItems,onChange:this.handleChange,onInputChange:this.handleUpdateInput,options:this.formattedListedItems,getOptionLabel:this.getOptionLabel,renderInput:this.renderInput,renderTags:this.renderTags}),s(p,{children:t})]}),s("div",{className:"c-chip-select-component__list-title",children:s("em",{children:this.props.listTitle})}),s(m,{className:b(this.props.listClasses,this.props.classes.listStyle),children:r(this.listedItems)?s("div",{className:"c-chip-select-component__empty-list",children:s("p",{"data-testid":"".concat("chipSelector","_emptyLabel"),children:"List is empty"})}):this.itemList})]})}},{key:"itemList",get:function(){var t=this;return this.listedItems.map((function(r){return s(u,{"data-testid":"".concat("chipSelector","_item_").concat(t.props.listItemFormatter(r)),button:!0,divider:!0,onClick:function(){return t.props.onAdd(e(r,"id"))},children:s(d,{children:t.props.listItemFormatter(r)})},e(r,"id"))}))}},{key:"listedItems",get:function(){var t=this;return this.props.items.filter((function(r){return!t.props.selectedItems.has(e(r,"id"))}))}},{key:"selectedItems",get:function(){var t=this;return this.props.items.filter((function(r){return t.props.selectedItems.has(e(r,"id"))})).concat(this.props.allowAddNewItems?this.props.newItems:[])}},{key:"formattedSelectedItems",get:function(){return this.selectedItems.map(this.formatItem)}},{key:"formattedListedItems",get:function(){return this.listedItems.map(this.formatItem)}}]),v}();N.propTypes={items:I.arrayOf(I.shape({})).isRequired,selectedItems:I.shape([]).isRequired,newItems:I.arrayOf(I.shape({})),onAdd:I.func.isRequired,onRemove:I.func.isRequired,allowAddNewItems:I.bool,onAddNew:I.func,onRemoveNew:I.func,chipFormatter:I.func,listItemFormatter:I.func,classes:I.string,listClasses:I.string,hintText:I.string,errorText:I.string,listTitle:I.string},N.defaultProps={allowAddNewItems:!1,chipFormatter:function(t){return t.toString()},listItemFormatter:function(t){return t.toString()},classes:"c-chip-select-component__container",listClasses:"c-chip-select-component__list",hintText:null,errorText:"You can not add not existing item",listTitle:"All items",onAddNew:null,onRemoveNew:null,newItems:null};var A=f({listStyle:{borderColor:"grey",overflow:"auto"},formControl:{marginBottom:8},inputRoot:{paddingBottom:"8px !important"}})(N);export default A;
