import e from"@babel/runtime/helpers/defineProperty";import{debounce as o}from"lodash";import n from"@material-ui/core/colors/blue";import{jsx as t,jsxs as r}from"react/jsx-runtime";import{useCallback as i,useEffect as s}from"react";import a from"prop-types";import{withStyles as l}from"@material-ui/core/styles";import c from"../Avatar/index.js";import{MentionsInput as u,Mention as p}from"react-mentions";import{USER_MARKUP as m}from"./constants.js";import f from"./style.css.js";import{handleFetchUsers as d}from"./utils/index.js";import{isUserCorvaAdmin as g}from"../../utils/user.js";function h(e,o){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),n.push.apply(n,t)}return n}function y(o){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach((function(n){e(o,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(t,e))}))}return o}var b={backgroundColor:n[100]},_={color:"#00bcd4"},O={suggestions:{item:{"&focused":{backgroundColor:"rgba(0, 0, 0, 0.08)"}}}},v=y(y({},O),{},{input:{color:"transparent",caretColor:"#fff",zIndex:1},highlighter:{color:"#fff"}}),j=y(y({},O),{},{input:{color:"#000"}}),w=function(e){var n=e.onChange,a=e.singleLine,l=e.suggestionsPortalHost,h=e.value,y=e.inputRef,O=e.classes,w=e.withLightTheme,P=e.placeholder,D=e.onMount,K=e.onKeyDown,R=e.onKeyUp,C=e.autoFocus,L=e.disabled,N=e.companyId,x=e.currentUser,S=i(o((function(e,o){var n=g(x)&&x.company_id!==N?[x.company_id,N]:null;d(e,o,n)}),400),[N]);return s(D,[]),t(u,{value:h,onChange:function(e,o){n(o)},singleLine:a,allowSpaceInQuery:!0,classNames:f,placeholder:P,suggestionsPortalHost:l,inputRef:y,style:w?j:v,onKeyDown:K,onKeyUp:R,autoFocus:C,disabled:L,children:t(p,{markup:m,renderSuggestion:function(e){return function(e,o){return r("div",{className:f.mention__suggestion,children:[t(c,{alt:e.display,displayName:e.display,className:o.avatar,imgSrc:e.photo}),r("div",{className:f.mention__suggestion__info,children:[t("span",{"data-testid":"".concat("userMention","_name_").concat(e.display),className:f.mention__suggestion__info__name,children:e.display}),e.title&&t("span",{className:f.mention__suggestion__info__group,children:e.title})]})]})}(e,O)},trigger:"@",data:S,displayTransform:function(e,o){return"@".concat(o)},style:w?b:_,appendSpaceOnAdd:!0})})};w.propTypes={onChange:a.func,singleLine:a.bool,suggestionsPortalHost:a.shape({current:a.instanceOf(Element)}),value:a.string,inputRef:a.shape({}),classes:a.shape({avatar:a.string.isRequired}).isRequired,withLightTheme:a.bool,placeholder:a.string,onMount:a.func,onKeyDown:a.func,onKeyUp:a.func,autoFocus:a.bool,disabled:a.bool,currentUser:a.shape({company_id:a.number.isRequired}).isRequired,companyId:a.number},w.defaultProps={onChange:function(){},singleLine:!1,suggestionsPortalHost:null,value:"",inputRef:null,withLightTheme:!0,placeholder:"Mention people using '@'",onMount:function(){},onKeyDown:function(){},onKeyUp:function(){},autoFocus:!0,disabled:!1,companyId:null};var P=l({avatar:{height:45,width:45,border:"1.5px solid #fff"}})(w);export default P;
