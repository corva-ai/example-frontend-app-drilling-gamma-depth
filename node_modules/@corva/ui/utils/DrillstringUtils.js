import e from"@babel/runtime/helpers/defineProperty";import t from"moment";import{getUnitPreference as r,convertValue as i,getUnitDisplay as s}from"./convert.js";import o from"lodash/get";import n from"lodash/set";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function l(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?a(Object(i),!0).forEach((function(r){e(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function _(e){return null==e||""===e}function h(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=i.isMinInclusive,o=void 0===s||s,n=parseFloat(e);return!Number.isNaN(n)&&(!(o&&n<t||!o&&n<=t)&&!(r&&n>r))}function g(e,t,s){var o=r("shortLength"),n=e,a=t;"in"!==o&&(n=i(e,"shortLength",o,"in"),a=i(t,"shortLength",o,"in"));var l=2.673*(a*a-n*n),_="in"!==o?i(l,"massPerLength","lb-ft"):l;return s>=.5*_&&s<=1.5*_}function d(e){var r=e.toJS().data,o=r.id,n=r.start_timestamp_str,a=r.start_depth,l=r.components,_=s("shortLength"),d=s("length"),m={general:{},components:{},specificErrors:{}},u=l.filter((function(e){return"bit"===e.family})),f=u.length>0?u[0].size:null,b=l.filter((function(e){return"mwd"===e.family&&e.has_gamma_sensor})),p=!1;if(isValueEmpty(o)&&(m.id="It should not be empty.",p=!0),n&&!t(new Date(n)).isValid()&&(p=!0,m.start_timestamp="Invalid Date."),Number.isFinite(a)){var v=i(0,"length","ft"),z=i(55e3,"length","ft"),w=i(1,"length","ft");(a<=v||a>z)&&(p=!0,m.start_depth="Should be a positive number ".concat(v.toFixed(2),"~").concat(z.toFixed(2)," (").concat(d,")")),a===w&&(p=!0,m.start_depth="Should not be equal to ".concat(w," (").concat(d,")"))}else p=!0,m.start_depth="It should not be empty.";for(var L=0;L<l.length;L+=1){var y=void 0,x=void 0,F=void 0,j=void 0,I=void 0,O=void 0,V=void 0,E=void 0,q=void 0,k=void 0,D=void 0,P=void 0,S=void 0,N=void 0,R=void 0,T=l[L],B={};switch(T.family){case"ct":y=i(0,"shortLength","in"),F=i(100,"shortLength","in"),x=i(1,"shortLength","in"),j=i(100,"shortLength","in"),N=i(0,"shortLength","in"),R=i(500,"shortLength","in"),V=i(0,"length","ft");break;case"dp":case"hwdp":y=i(1,"shortLength","in"),F=i(7,"shortLength","in"),x=i(2,"shortLength","in"),j=i(8,"shortLength","in"),E=i(1,"shortLength","in"),q=i(7,"shortLength","in"),k=i(2,"shortLength","in"),D=i(10,"shortLength","in"),V=i(0,"length","ft");break;case"dc":y=i(.5,"shortLength","in"),F=i(7,"shortLength","in"),x=i(2,"shortLength","in"),j=i(13,"shortLength","in"),V=i(0,"length","ft");break;case"stabilizer":y=i(0,"shortLength","in"),F=i(100,"shortLength","in"),x=i(1,"shortLength","in"),j=i(100,"shortLength","in"),V=i(0,"length","ft");break;case"pdm":x=i(2,"shortLength","in"),j=i(15,"shortLength","in"),y=i(0,"shortLength","in"),F=i(12,"shortLength","in"),V=i(4,"length","ft"),S=0;break;case"mwd":case"agitator":case"rss":x=i(2,"shortLength","in"),j=i(13,"shortLength","in"),y=i(0,"shortLength","in"),F=i(12,"shortLength","in"),V=i(1,"length","ft"),P=0;break;case"ur":y=i(0,"shortLength","in"),F=i(50,"shortLength","in"),x=i(1,"shortLength","in"),j=i(50,"shortLength","in"),I=i(1,"shortLength","in"),O=i(50,"shortLength","in");break;case"bit":break;default:y=i(0,"shortLength","in"),F=i(100,"shortLength","in"),x=i(1,"shortLength","in"),j=i(100,"shortLength","in"),V=i(0,"length","ft")}if(isValueEmpty(y)||isValueEmpty(x)||(h(T.inner_diameter,y,F)||(B.inner_diameter="".concat(y.toFixed(1),"~").concat(F.toFixed(1)," (").concat(_,")"),p=!0),h(T.outer_diameter,x,j)||(B.outer_diameter="".concat(x.toFixed(1),"~").concat(j.toFixed(1)," (").concat(_,")"),p=!0),h(T.inner_diameter,y,F)&&h(T.outer_diameter,x,j)&&!h(T.inner_diameter,y,T.outer_diameter)&&(B.outer_diameter="O.D > I.D",p=!0),!B.outer_diameter&&f&&+T.outer_diameter+i(.1,"shortLength","in")>f&&(B.outer_diameter=" O.D + 0.1 < Bit Size",p=!0),h(T.linear_weight,0)||(B.linear_weight="Invalid value",p=!0),"dp"!==T.family&&"hwdp"!==T.family&&"dc"!==T.family&&"ct"!==T.family&&"ur"!==T.family||B.inner_diameter||B.outer_diameter||B.linear_weight||g(T.inner_diameter,T.outer_diameter,T.linear_weight)||(B.linear_weight="Invalid range",p=!0)),"ur"===T.family&&(h(T.ur_opened_od,I,O)?T.ur_opened_od<f&&(B.ur_opened_od="Max O.D (Opened) >= Bit Size",p=!0):(B.ur_opened_od="".concat(I.toFixed(1),"~").concat(O.toFixed(1)," (").concat(_,")"),p=!0)),isValueEmpty(E)||isValueEmpty(k)||(h(T.inner_diameter_tooljoint,E,q)||(B.inner_diameter_tooljoint="".concat(E.toFixed(1),"~").concat(q.toFixed(1)," (").concat(_,")"),p=!0),h(T.outer_diameter_tooljoint,k,D)||(B.outer_diameter_tooljoint="".concat(k.toFixed(1),"~").concat(D.toFixed(1)," (").concat(_,")"),p=!0),h(T.outer_diameter_tooljoint,T.outer_diameter,D)||(B.outer_diameter_tooljoint="Tool Joint O.D >= O.D",p=!0)),isValueEmpty(V)||h(T.length,V)||(B.length="Invalid value",p=!0),isValueEmpty(T.length_tooljoint)||isValueEmpty(T.component_length)||+T.length_tooljoint>+T.component_length&&(B.length_tooljoint="Tool Joint Length < Component Length",p=!0),T.off_bottom_pressure_loss&&T.off_bottom_pressure_loss.length>0){B.off_bottom_pressure_loss={};for(var J=0;J<T.off_bottom_pressure_loss.length;J+=1){var M=T.off_bottom_pressure_loss[J];B.off_bottom_pressure_loss[J]={},isValueEmpty(M.flow_rate)&&(B.off_bottom_pressure_loss[J].flow_rate="flow rate is required.",p=!0),isValueEmpty(M.pressure_loss)&&(B.off_bottom_pressure_loss[J].pressure_loss="pressure loss is required.",p=!0),isValueEmpty(S)||h(M.pressure_loss,S,null,{isMinInclusive:!1})||(B.off_bottom_pressure_loss[J].pressure_loss="Invalid range",p=!0)}}if(T.pressure_loss&&T.pressure_loss.length>0){B.pressure_loss={};for(var C=0;C<T.pressure_loss.length;C+=1){var A=T.pressure_loss[C];B.pressure_loss[C]={},isValueEmpty(A.flow_rate)&&(B.pressure_loss[C].flow_rate="flow rate is required.",p=!0),isValueEmpty(A.pressure_loss)&&(B.pressure_loss[C].pressure_loss="pressure loss is required.",p=!0),isValueEmpty(P)||h(A.pressure_loss,P,null,{isMinInclusive:!1})||(B.pressure_loss[C].pressure_loss="Invalid range",p=!0)}}if(T.has_stabilizer&&T.stabilizer){var G=i(0,"shortLength","in"),H=i(100,"shortLength","in"),K=i(1,"shortLength","in"),Q=i(100,"shortLength","in"),U=i(0,"length","ft");h(T.stabilizer.inner_diameter,G,H)&&h(T.stabilizer.outer_diameter,K,Q)&&!h(T.stabilizer.inner_diameter,y,T.stabilizer.outer_diameter)&&(B.stabilizer_outer_diameter="O.D > I.D",p=!0),h(T.stabilizer.inner_diameter,G,H)||(B.stabilizer_inner_diameter="".concat(G.toFixed(1),"~").concat(H.toFixed(1)," (").concat(_,")"),p=!0),h(T.stabilizer.outer_diameter,K,Q)||(B.stabilizer_outer_diameter="".concat(K.toFixed(1),"~").concat(Q.toFixed(1)," (").concat(_,")"),p=!0),isValueEmpty(U)||h(T.stabilizer.length,U)||(B.stabilizer_length="Invalid value",p=!0),isValueEmpty(T.stabilizer.linear_weight)&&(B.stabilizer_linear_weight="Invalid value",p=!0),!B.stabilizer_outer_diameter&&f&&+T.stabilizer.outer_diameter+i(.1,"shortLength","in")>f&&(B.stabilizer_outer_diameter=" O.D + 0.1 < Bit Size",p=!0)}if("ct"===T.family&&(h(T.reel_diameter,N,R)||(B.reel_diameter="".concat(N.toFixed(1),"~").concat(R.toFixed(1)," (").concat(_,")"),p=!0)),"bit"===T.family){var W=c(1,"shortLength","in"),X=W*W*0,Y=W*W*20;h(T.tfa,X,Y)||(B.tfa="TFA must be ".concat(X.toFixed(2),"~").concat(20..toFixed(2)),p=!0)}if("rss"===T.family&&(h(T.flow_loss_percentage,0,10)||(B.flow_loss_percentage="It must be ".concat(0,"~").concat(10),p=!0)),"mwd"===T.family&&(b.length>1?(B.gamma_sensor_to_bit_distance="Only 1 gamma sensor allowed. Currently ".concat(b.length),p=!0):T.has_gamma_sensor&&!Number.isFinite(T.gamma_sensor_to_bit_distance)&&(B.gamma_sensor_to_bit_distance="This field is required.",p=!0),T.has_survey_sensor&&!Number.isFinite(T.bit_to_survey_distance)?(B.bit_to_survey_distance="This field is required.",p=!0):T.has_survey_sensor&&T.bit_to_survey_distance<=0?(B.bit_to_survey_distance="Should be a positive number.",p=!0):T.has_survey_sensor&&T.bit_to_survey_distance>150&&(B.bit_to_survey_distance="Should be less then 150.",p=!0),T.has_directional_sensor&&!Number.isFinite(T.directional_sensor_to_bit_distance)?(B.directional_sensor_to_bit_distance="This field is required.",p=!0):T.has_directional_sensor&&T.directional_sensor_to_bit_distance<=0?(B.directional_sensor_to_bit_distance="Should be a positive number.",p=!0):T.has_directional_sensor&&T.directional_sensor_to_bit_distance>150&&(B.directional_sensor_to_bit_distance="Should be less then 150.",p=!0)),"pdm"===T.family){var Z=void 0,$=void 0;h(T.number_rotor_lobes,1,10)||(B.number_rotor_lobes="It must be ".concat(1,"~").concat(10),p=!0),h(T.number_stator_lobes,2,10)||(B.number_stator_lobes="It must be ".concat(2,"~").concat(10),p=!0),h(T.rpg,0,10)||(B.rpg="It must be ".concat(0,"~").concat(10),p=!0),Z=i(0,"force","klbf"),$=i(200,"force","klbf"),isValueEmpty(T.max_weight_on_bit)||h(T.max_weight_on_bit,Z,$)||(B.max_weight_on_bit="It must be ".concat($.toFixed(2),"~").concat($.toFixed(2)),p=!0),Z=i(0,"volumeFlowRate","gal/min"),$=i(2500,"volumeFlowRate","gal/min"),h(T.min_standard_flowrate,Z,$)||(B.min_standard_flowrate="It must be ".concat(Z.toFixed(2),"~").concat($.toFixed(2)),p=!0),h(T.max_standard_flowrate,Z,$)||(B.max_standard_flowrate="It must be ".concat(Z.toFixed(2),"~").concat($.toFixed(2)),p=!0),Z=i(0,"pressure","psi"),$=i(3e3,"pressure","psi"),h(T.max_operating_differential_pressure,Z,$)||(B.max_operating_differential_pressure="It must be ".concat(Z.toFixed(2),"~").concat($.toFixed(2)),p=!0),Z=i(0,"torque","ft-klbf"),$=i(40,"torque","ft-klbf"),h(T.torque_at_max_operating_differential_pressure,Z,$)||(B.torque_at_max_operating_differential_pressure="It must be ".concat(Z.toFixed(2),"~").concat($.toFixed(2)),p=!0),h(T.flow_loss_percentage,0,20)||(B.flow_loss_percentage="It must be ".concat(0,"~").concat(20),p=!0)}m.components[T.id]=B}return 1!==u.length&&(m.general.bit_count='Number of "BIT" components is invalid.',p=!0),1===u.length&&"bit"!==l[l.length-1].family&&"bit"!==l[0].family&&(m.general.bit_position='"BIT" category should be on the bottom of the list.',p=!0),p?m:null}function m(e){var r=o(e,["data","components"]);"bit"===o(r,[0,"family"])&&(r=r.reverse().map((function(e,t){return l(l({},e),{},{order:t})})),e=n(e,["data","components"],r));var i=e.toJS().data,s=i.start_timestamp_str&&t(new Date(i.start_timestamp_str));return s&&s.isValid()&&(i.start_timestamp=s.unix()),delete i.start_timestamp_str,i.start_depth=u(i.start_depth,"length","ft"),i.components=i.components.map((function(e){var t=Object.assign({},e);if(t.inner_diameter=u(t.inner_diameter,"shortLength","in"),t.outer_diameter=u(t.outer_diameter,"shortLength","in",4),t.linear_weight=u(t.linear_weight,"massPerLength","lb-ft"),t.weight=u(t.weight,"mass","lb"),t.length=u(t.length,"length","ft"),t.component_length=u(t.component_length,"length","ft"),t.outer_diameter_tooljoint=u(t.outer_diameter_tooljoint,"shortLength","in"),t.inner_diameter_tooljoint=u(t.inner_diameter_tooljoint,"shortLength","in"),t.length_tooljoint=u(t.length_tooljoint,"length","ft"),"bit"===t.family||"ur"===t.family){var r=u(1,"shortLength","in");if(t.size=u(t.size,"shortLength","in",3),t.nozzle_sizes&&t.nozzle_sizes.length>0)for(var i=0;i<t.nozzle_sizes.length;i+=1){var s=t.nozzle_sizes[i];s.size=1!==r?32*u(s.size,"shortLength","in"):s.size}t.tfa=1!==r?t.tfa*(r*r):t.tfa}if("pdm"===t.family){if(t.max_weight_on_bit=u(t.max_weight_on_bit,"force","klbf"),t.min_standard_flowrate=u(t.min_standard_flowrate,"volumeFlowRate","gal/min"),t.max_standard_flowrate=u(t.max_standard_flowrate,"volumeFlowRate","gal/min"),t.max_operating_differential_pressure=u(t.max_operating_differential_pressure,"pressure","psi"),t.torque_at_max_operating_differential_pressure=u(t.torque_at_max_operating_differential_pressure,"torque","ft-klbf",3),t.rpg=u(t.rpg,"revolutionPerVolume","rpg"),t.off_bottom_pressure_loss&&t.off_bottom_pressure_loss.length>0)for(var o=0;o<t.off_bottom_pressure_loss.length;o+=1){var n=t.off_bottom_pressure_loss[o];n.flow_rate=u(n.flow_rate,"volumeFlowRate","gal/min"),n.pressure_loss=u(n.pressure_loss,"pressure","psi")}t.has_stabilizer||delete t.stabilizer,t.stabilizer&&(t.stabilizer.inner_diameter=t.stabilizer.inner_diameter&&u(t.stabilizer.inner_diameter,"shortLength","in"),t.stabilizer.outer_diameter=t.stabilizer.outer_diameter&&u(t.stabilizer.outer_diameter,"shortLength","in"),t.stabilizer.linear_weight=t.stabilizer.linear_weight&&u(t.stabilizer.linear_weight,"massPerLength","lb-ft"),t.stabilizer.weight=t.stabilizer.weight&&u(t.stabilizer.weight,"mass","lb"),t.stabilizer.length=t.length&&u(t.stabilizer.length,"length","ft"),t.stabilizer.gauge_od=t.stabilizer.gauge_od&&u(t.stabilizer.gauge_od,"shortLength","in"),t.stabilizer.gauge_length=t.stabilizer.gauge_length&&u(t.stabilizer.gauge_length,"shortLength","in"),t.stabilizer.blade_width=t.stabilizer.blade_width&&u(t.stabilizer.blade_width,"shortLength","in"),t.stabilizer.stab_centerpoint_to_bit=t.stabilizer.stab_centerpoint_to_bit&&u(t.stabilizer.stab_centerpoint_to_bit,"length","ft"))}if("stabilizer"===t.family&&(t.gauge_od=u(t.gauge_od,"shortLength","in"),t.gauge_length=u(t.gauge_length,"shortLength","in"),t.blade_width=u(t.blade_width,"shortLength","in")),("mwd"===t.family||"rss"===t.family||"agitator"===t.family)&&t.pressure_loss&&t.pressure_loss.length>0)for(var a=0;a<t.pressure_loss.length;a+=1){var l=t.pressure_loss[a];l.flow_rate=u(l.flow_rate,"volumeFlowRate","gal/min"),l.pressure_loss=u(l.pressure_loss,"pressure","psi")}return"bit"!==t.family&&delete t.bit_type,!t.has_gamma_sensor&&Number.isFinite(t.gamma_sensor_to_bit_distance)&&delete t.gamma_sensor_to_bit_distance,!t.has_survey_sensor&&Number.isFinite(t.bit_to_survey_distance)&&delete t.bit_to_survey_distance,!t.has_directional_sensor&&Number.isFinite(t.directional_sensor_to_bit_distance)&&delete t.directional_sensor_to_bit_distance,delete t.c_length,t})),l(l({},e),{},{data:i})}function u(e,t,s){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return null==e?null:t&&s?parseFloat(i(e,t,r(t),s,o)):parseFloat(e)}function f(e){var t=e.toJS().data,r=t.components;if(t.start_depth=c(t.start_depth,"length","ft"),r.length>0)if("bit"===r[0].family){r[0].c_length=r[0].length||0;for(var i=1;i<r.length;i+=1)r[i].c_length=parseFloat(r[i-1].c_length)+parseFloat(r[i].length||0)}else{var s=r.length-1;r[s].c_length=r[s].length||0;for(var o=s-1;o>=0;o-=1)r[o].c_length=parseFloat(r[o+1].c_length)+parseFloat(r[o].length||0)}for(var n=0;n<r.length;n+=1){var a=r[n];if(a.inner_diameter=c(a.inner_diameter,"shortLength","in"),a.outer_diameter=c(a.outer_diameter,"shortLength","in",4),a.linear_weight=c(a.linear_weight,"massPerLength","lb-ft"),a.weight=c(a.weight,"mass","lb"),a.length=c(a.length,"length","ft"),a.component_length=c(a.component_length,"length","ft"),a.outer_diameter_tooljoint=c(a.outer_diameter_tooljoint,"shortLength","in"),a.inner_diameter_tooljoint=c(a.inner_diameter_tooljoint,"shortLength","in"),a.length_tooljoint=c(a.length_tooljoint,"length","ft"),a.c_length=c(a.c_length,"length","ft"),a.gamma_sensor_to_bit_distance=c(a.gamma_sensor_to_bit_distance,"length","ft"),"bit"===a.family||"ur"===a.family){var _=c(1,"shortLength","in");if(a.size=c(a.size,"shortLength","in"),a.nozzle_sizes&&a.nozzle_sizes.length>0)for(var h=0;h<a.nozzle_sizes.length;h+=1){var g=a.nozzle_sizes[h];g.size=1!==_?c(g.size,"shortLength","in")/32:g.size}a.tfa=1!==_?a.tfa*(_*_):a.tfa}if("pdm"===a.family){if(a.max_weight_on_bit=c(a.max_weight_on_bit,"force","klbf"),a.min_standard_flowrate=c(a.min_standard_flowrate,"volumeFlowRate","gal/min"),a.max_standard_flowrate=c(a.max_standard_flowrate,"volumeFlowRate","gal/min"),a.max_operating_differential_pressure=c(a.max_operating_differential_pressure,"pressure","psi"),a.torque_at_max_operating_differential_pressure=c(a.torque_at_max_operating_differential_pressure,"torque","ft-klbf",3),a.off_bottom_pressure_loss&&a.off_bottom_pressure_loss.length>0)for(var d=0;d<a.off_bottom_pressure_loss.length;d+=1){var m=a.off_bottom_pressure_loss[d];m.flow_rate=c(m.flow_rate,"volumeFlowRate","gal/min"),m.pressure_loss=c(m.pressure_loss,"pressure","psi")}a.rpg=c(a.rpg,"revolutionPerVolume","rpg"),a.has_stabilizer&&a.stabilizer&&(a.stabilizer.inner_diameter=c(a.stabilizer.inner_diameter,"shortLength","in"),a.stabilizer.outer_diameter=c(a.stabilizer.outer_diameter,"shortLength","in"),a.stabilizer.linear_weight=c(a.stabilizer.linear_weight,"massPerLength","lb-ft"),a.stabilizer.weight=c(a.stabilizer.weight,"mass","lb"),a.stabilizer.length=c(a.stabilizer.length,"length","ft"),a.stabilizer.gauge_od=c(a.stabilizer.gauge_od,"shortLength","in"),a.stabilizer.gauge_length=c(a.stabilizer.gauge_length,"shortLength","in"),a.stabilizer.blade_width=c(a.stabilizer.blade_width,"shortLength","in"),a.stabilizer.stab_centerpoint_to_bit=c(a.stabilizer.stab_centerpoint_to_bit,"length","ft"))}if("stabilizer"===a.family&&(a.gauge_od=c(a.gauge_od,"shortLength","in"),a.gauge_length=c(a.gauge_length,"shortLength","in"),a.blade_width=c(a.blade_width,"shortLength","in")),("mwd"===a.family||"rss"===a.family||"agitator"===a.family)&&a.pressure_loss&&a.pressure_loss.length>0)for(var u=0;u<a.pressure_loss.length;u+=1){var f=a.pressure_loss[u];f.flow_rate=c(f.flow_rate,"volumeFlowRate","gal/min"),f.pressure_loss=c(f.pressure_loss,"pressure","psi")}}return l(l({},e),{},{data:t})}function c(e,t,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return 0===e||e?t&&r?i(e,t,r,null,s):e:null}export{m as convertRecordBackToImperialUnit,f as convertRecordtoPrefUnit,u as ctoi,c as ctop,g as isValidLinearWeight,h as isValidNumber,_ as sValueEmpty,d as validate};
