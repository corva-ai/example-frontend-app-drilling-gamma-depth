import e from"@babel/runtime/helpers/defineProperty";import{get as r,isEqual as n,last as t}from"lodash";import{getUnitDisplay as i}from"../../../utils/convert.js";import a from"@babel/runtime/helpers/slicedToArray";import{jsxs as o,jsx as c,Fragment as s}from"react/jsx-runtime";import{withStyles as l,Tooltip as m,Button as u}from"@material-ui/core";import{useState as p,useContext as d,useRef as f}from"react";import h from"prop-types";import g from"classnames";import y from"../../Modal/index.js";import{DEFAULT_TRACE_SETTINGS as b,MAX_TRACE_COUNT as v}from"../constants.js";import S from"@material-ui/icons/Add";import T from"./TraceSettings.js";import j from"../SettingsContext.js";import N from"../DataContext.js";import k from"./TraceHeader.css.js";function O(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function C(r){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?O(Object(t),!0).forEach((function(n){e(r,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))}))}return r}var x=function(e){return Number.isFinite(e)?Math.round(100*e)/100:"-"},M=function(l){var h,O=l.onChange,M=l.onDelete,P=l.traceSettings,D=l.classes,q=l.mapping,R=l.index,w=l.openTrackSettings,z=p(!1),E=a(z,2),F=E[0],L=E[1],A=p(!1),H=a(A,2),B=H[0],G=H[1],I=p(!1),J=a(I,2),K=J[0],Q=J[1],U=p(P),V=a(U,2),W=V[0],X=V[1],Y=p(b),Z=a(Y,2),$=Z[0],_=Z[1],ee=d(j),re=ee.horizontal,ne=ee.maxTracesCount,te=d(N).parsedData,ie=f(),ae=r(te,P&&"".concat(P.collection,".").concat(P.key),{}),oe=ae.min,ce=ae.max,se=ae.data,le=ne>=5,me=function(){O(B?$:W),L(!1),G(!1),_(b)},ue=function(){clearTimeout(ie.current),ie.current=setTimeout((function(){Q(!1)}),1e3)},pe=!P||!P.name,de=R===ne-1,fe=ne>=v,he=B?!$.key:n(P,W),ge=se?x(r(t(se),1,"-")):"-";return o("div",{onMouseEnter:function(){return Q(!0)},onMouseLeave:ue,className:g(k.container,e({},k.horizontal,re)),children:[c(m,{title:le&&!pe?o("p",{children:[P.name,": ",c("br",{})," ",ge," (",i(P.unitType)||P.unit,")"]}):"",children:o("div",{className:g(k.header,(h={},e(h,k.horizontal,re),e(h,k.vertical,!re),e(h,k.last,de),e(h,k.minimal,le),h)),onClick:function(){return L(!0)},children:[pe&&c("div",{className:k.empty,children:c(S,{color:"primary",fontSize:"small"})}),!pe&&o(s,{children:[!le&&o("span",{className:k.unit,children:[P.name," (",i(P.unitType)||P.unit,")"]}),c("span",{className:k.current,children:ge}),o("div",{className:k.values,children:[c("span",{className:k.min,children:!P.autoScale&&Number.isFinite(P.scaleMin)?P.scaleMin:x(oe)}),c("span",{className:k.max,children:!P.autoScale&&Number.isFinite(P.scaleMax)?P.scaleMax:x(ce)})]}),c("div",{className:k.line,style:{borderColor:P.color,borderStyle:P.dashStyle}})]})]})}),de&&!pe&&K&&!fe&&c("div",{className:k.addTrace,onClick:function(){G(!0),L(!0)},onMouseLeave:ue,onMouseEnter:function(){return clearTimeout(ie.current)},children:c(S,{color:"primary",fontSize:"small"})}),c(y,{open:F,title:o("div",{className:k.modalTitle,children:[o("span",{className:k.trackTitle,onClick:function(){me(),w()},children:["Track Settings /"," "]}),P.name||"Empty Trace"]}),actions:o("div",{className:k.actions,children:[c(u,{className:D.button,color:"primary",onClick:function(){M(P.id),L(!1)},disabled:!P||!P.id,children:"Delete Trace"}),c(u,{className:D.button,color:"primary",onClick:function(){L(!1),G(!1),_(b)},children:"Cancel"}),c(u,{className:D.button,variant:"contained",color:"primary",onClick:me,disabled:he,children:"Save"})]}),children:c(T,{traceSettings:B?$:W,onChange:function(r,n){var t=a(B?[$,_]:[W,X],2),i=t[0],o=t[1];if("key"===r){var c=q.find((function(e){return e.key===n}));o(C(C({},i),{},e({},r,n),c))}else o(C(C({},i),{},e({},r,n)))},mapping:q})})]})};M.propTypes={onChange:h.func.isRequired,onDelete:h.func.isRequired,openTrackSettings:h.func,classes:h.shape({}).isRequired,traceSettings:h.shape({name:h.string,key:h.string,id:h.string,unit:h.string,unitType:h.string,autoScale:h.bool,scaleMin:h.string,scaleMax:h.string,color:h.string,dashStyle:h.string,collection:h.string}),mapping:h.arrayOf(h.shape({name:h.string.isRequired,key:h.string.isRequired}).isRequired).isRequired,index:h.number.isRequired},M.defaultProps={traceSettings:b,openTrackSettings:function(){}};var P=l({button:{fontSize:14,marginLeft:20}})(M);export default P;
